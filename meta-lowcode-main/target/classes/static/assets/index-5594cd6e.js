import{_ as e,f as l,L as t,M as a,N as r,O as o}from"./index-ea085229.js";import i from"./ActivateAuth-49aa122f.js";import{s}from"./pinia-3f60a8e1.js";import{b as n,a as p}from"./element-plus-bab58d46.js";import{p as u,r as d,v as c,l as y,Y as m,o as k,a as b,X as g,E as f,i as v,w as j,c as S,F as O,A as h,g as E,f as w,z as T,t as x,e as I,G as V,n as q,bh as U,bf as P}from"./@vue-1ad4818c.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./@babel-6bd44fd1.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./@element-plus-2a6d398c.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./@vueuse-477b4dbb.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./lodash-es-b8e8104a.js";import"./@ant-design-60f2ef8e.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";import"./@popperjs-b78c3215.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";const A=[{label:"通用配置",code:"common",confs:[{label:"当前版本号",key:"webVer",type:"text"},{label:"名称",key:"appName",type:"input",required:!0,isError:!1},{label:"LOGO",key:"logo",type:"uptadeLogo",required:!0,isError:!1},{label:"主页地址/域名",key:"homeURL",type:"input",validation:"url",isError:!1},{label:"主色调",key:"themeColor",type:"picker",required:!0,isError:!1},{label:"版本号",key:"dbVersion",type:"input"},{label:"页面水印",key:"watermark",type:"switch"},{label:"数据自动备份",key:"autoBackup",type:"switch"},{label:"备份周期",key:"backupCycle",required:!0,type:"numInput",suffixText:"天备份一次"},{label:"备份保留时间(天)",key:"backupOverdueDay",required:!0,type:"numInput"}]},{label:"登录页配置",code:"loginPage",confs:[{label:"标题",key:"appTitle",type:"input",required:!0,isError:!1},{label:"子标题",key:"appSubtitle",type:"input"},{label:"简介",key:"appIntro",type:"input"},{label:"页脚",key:"pageFooter",type:"input"}]},{label:"服务集成",code:"serviceIntegration",confs:[{label:"启用短信服务 (SUBMAIL)",key:"smsOpen",type:"switch"},{label:"APPID",key:"smsappId",type:"input",required:!0,isError:!1},{label:"APPKEY",key:"smsappKey",type:"input",required:!0,isError:!1},{label:"短信签名",key:"smssignature",type:"input",required:!0,isError:!1},{label:"启用邮件服务 (SUBMAIL/SMTP)",key:"emailOpen",type:"switch"},{label:"APPID",key:"appId",type:"input",required:!0,isError:!1},{label:"APPKEY",key:"appKey",type:"input",required:!0,isError:!1},{label:"发件人地址",key:"from",type:"input",required:!0,isError:!1},{label:"发件人名称",key:"fromName",type:"input",required:!0,isError:!1},{label:"抄送地址",key:"cc",type:"input"},{label:"启用云存储 (七牛云)",key:"cloudStorageOpen",type:"switch"},{label:"ACCESSKEY",key:"accessKey",type:"input",required:!0,isError:!1},{label:"SECRETKEY",key:"secretKey",type:"input",required:!0,isError:!1},{label:"存储空间",subLabel:"存储空间变更需你自行迁移原有数据",key:"bucket",type:"input",required:!0,isError:!1},{label:"访问域名",key:"host",type:"input",required:!0,isError:!1}]},{label:"钉钉集成",code:"dingTalkIntegration",confs:[{label:"启用钉钉服务",key:"dingTalkOpen",type:"switch"},{label:"AGENTID",key:"dingTalkAgentId",type:"input",required:!0,isError:!1},{label:"APPKEY",key:"dingTalkAppKey",type:"input",required:!0,isError:!1},{label:"APPSECRET",key:"dingTalkAppSecret",type:"input",required:!0,isError:!1},{label:"应用首页地址",subLabel:"请复制地址至钉钉相关配置",key:"homeDir",type:"input",disabled:!0},{label:"回调域名",subLabel:"请复制地址至钉钉相关配置",key:"homeURL",type:"input",disabled:!0},{label:"用户默认角色",key:"nodeRole",type:"mlSelectUser"},{label:"自动同步部门用户",key:"nodeDep",type:"autoSync"}]},{label:"授权许可",code:"authLicense",confs:[{label:"公司名称",key:"companyName",keyFrom:"licenseInfo",type:"text"},{label:"账号",key:"account",keyFrom:"licenseInfo",type:"text"},{label:"实体数量",key:"entityLimit",keyFrom:"licenseInfo",type:"text"},{label:"产品类型",key:"productType",keyFrom:"licenseInfo",type:"text"},{label:"设备号",key:"deviceNo",keyFrom:"licenseInfo",type:"text"}]}],L=e=>(U("data-v-dd4d6ed5"),e=e(),P(),e),_={class:"common-config"},C={class:"config-label"},K={key:0,class:"is-required"},R={key:0},D={key:0},F={key:1},N={key:1},z={class:"info-text"},M={key:2},B={key:3},Y={key:4},G={key:5},H={key:0,class:"ml-10"},J={key:6},X=L((()=>E("span",{class:"ml-2"},"同步失败",-1))),Q=L((()=>E("span",{class:"ml-2"},"立即同步",-1))),W={key:7,style:{width:"178px"}},Z=["onClick"],$={class:"footer mt-20"},ee=e({__name:"index",setup(e){const{publicSetting:U}=s(l());u((()=>{se()}));let P=d(),L=d("common"),ee=c({nodeRole:[],homeDir:""}),le=d(!1),te=d(["dingTalkOpen"]),ae=d(["smsappId","smsappKey","smssignature"]),re=d(["appId","appKey","from","fromName","cc"]),oe=d(["accessKey","secretKey","bucket","host"]),ie=d(["dingTalkAppKey","dingTalkAppSecret","dingTalkAgentId","nodeDep"]);const se=async()=>{P.value=[...A],le.value=!0;let e=await t();if(e){let l=e.data?e.data:{};ee=Object.assign(ee,l),ee.webVer=U.value.webVer;let{emailSetting:t,smsSetting:a,cloudStorageSetting:r,dingTalkSetting:o}=ee;ee.smsOpen=a.openStatus;for(const e in a)if(Object.hasOwnProperty.call(a,e)){const l=a[e];ee["sms"+e]=l}ee.emailOpen=t.openStatus;for(const e in t)if(Object.hasOwnProperty.call(t,e)){const l=t[e];ee[e]=l}ee.cloudStorageOpen=r.openStatus;for(const e in r)if(Object.hasOwnProperty.call(r,e)){const l=r[e];ee[e]=l}ee.dingTalkOpen=o.openStatus;for(const e in o)if(Object.hasOwnProperty.call(o,e)){const l=o[e];ee[e]=l,"nodeRole"!=e||l||(ee[e]=[])}ee.logo||(ee.logo="/src/assets/imgs/logo.png"),ee.homeDir=ee.homeURL+"/dingTalk/userLogin",ee.backupCycle=1*ee.backupCycle||1,ee.backupOverdueDay=1*ee.backupOverdueDay||30}le.value=!1},ne=e=>{ee.logo=e.url},pe=(e,l)=>!("serviceIntegration"!=e.code||ee.smsOpen||!ae.value.includes(l.key))||(!("serviceIntegration"!=e.code||ee.emailOpen||!re.value.includes(l.key))||(!("serviceIntegration"!=e.code||ee.cloudStorageOpen||!oe.value.includes(l.key))||!("dingTalkIntegration"!=e.code||ee.dingTalkOpen||!ie.value.includes(l.key)))),ue=async()=>{if(U.value.trialVersionFlag)return void n.alert("近期有多名不怎么可爱的用户恶意修改美乐演示版本内容，因此该功能在演示版本已被禁用！<br />\n            如需体验该功能，请联系美乐官网客服为您安排单独的体验环境，或者官网下载免费版使用。<br />\n            谢谢理解！","提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确认",type:"warning",callback:()=>{}});if(!ce())return;if(ee.smsOpen)for(const e in ee.smsSetting)Object.hasOwnProperty.call(ee.smsSetting,e)&&(ee.smsSetting[e]=ee["sms"+e]);if(ee.smsSetting.openStatus=ee.smsOpen,ee.emailOpen)for(const e in ee.emailSetting)Object.hasOwnProperty.call(ee.emailSetting,e)&&(ee.emailSetting[e]=ee[e]);if(ee.emailSetting.openStatus=ee.emailOpen,ee.cloudStorageOpen)for(const e in ee.cloudStorageSetting)Object.hasOwnProperty.call(ee.cloudStorageSetting,e)&&(ee.cloudStorageSetting[e]=ee[e]);if(ee.cloudStorageSetting.openStatus=ee.cloudStorageOpen,ee.dingTalkOpen)for(const e in ee.dingTalkSetting)Object.hasOwnProperty.call(ee.dingTalkSetting,e)&&(ee.dingTalkSetting[e]=ee[e]);ee.dingTalkSetting.openStatus=ee.dingTalkOpen,await a(ee)?(p.success("保存成功"),q((()=>{location.reload()}))):le.value=!1},de=c({input:"请输入",uptade:"请上传",uptadeLogo:"请上传",radio:"请选择",checkbox:"请选择"}),ce=()=>{for(let e=0;e<P.value.length;e++){const l=P.value[e];for(let e=0;e<l.confs.length;e++){const t=l.confs[e];if("url"==t.validation&&ee[t.key]&&-1==ee[t.key].indexOf("http://")&&-1==ee[t.key].indexOf("https://"))return t.isError=!0,L.value=l.code,p.warning("请输入有效域名"),!1;if(t.required&&!ee[t.key]&&!ae.value.includes(t.key)&&!re.value.includes(t.key)&&!oe.value.includes(t.key)&&!ie.value.includes(t.key))return t.isError=!0,L.value=l.code,p.warning(de[t.type]+t.label),!1;if(t.required&&!ee[t.key]&&ae.value.includes(t.key)&&ee.smsOpen)return t.isError=!0,L.value=l.code,p.warning(de[t.type]+t.label),!1;if(t.required&&!ee[t.key]&&re.value.includes(t.key)&&ee.emailOpen)return t.isError=!0,L.value=l.code,p.warning(de[t.type]+t.label),!1;if(t.required&&!ee[t.key]&&oe.value.includes(t.key)&&ee.cloudStorageOpen)return t.isError=!0,L.value=l.code,p.warning(de[t.type]+t.label),!1;if(t.required&&!ee[t.key]&&ie.value.includes(t.key)&&ee.dingTalkOpen)return t.isError=!0,L.value=l.code,p.warning(de[t.type]+t.label),!1}}return!0};let ye=d();const me=()=>{ye.value.openDailog(ee.licenseInfo)},ke=e=>ee[e.key];let be=d(!1),ge=d(),fe=d(!1),ve=d("");const je=async()=>{be.value=!0;let e=ee.nodeRole[0]?ee.nodeRole[0].id:null,l=await r(e);l&&l.data?(ge.value=l.data,Se()):be.value=!1},Se=async()=>{let e=await o(ge.value);e&&e.data?(fe.value=e.data.finish,ve.value=e.data.errorMessage,fe.value||setTimeout((()=>{Se()}),5e3)):be.value=!0,fe.value&&(be.value=!1,ve.value?p.error("同步失败"):p.success("同步成功"))};return(e,l)=>{const t=y("el-input"),a=y("el-switch"),r=y("el-tooltip"),o=y("el-color-picker"),s=y("mlSelectUser"),n=y("el-input-number"),p=y("ElIconRefresh"),u=y("el-icon"),d=y("el-button"),c=y("mlLogo"),q=y("ElIconPlus"),A=y("ml-upload"),ae=y("el-descriptions-item"),re=y("el-descriptions"),oe=y("el-tab-pane"),ie=y("el-tabs"),de=y("el-card"),ce=m("loading");return k(),b("div",_,[g((k(),v(de,{shadow:"never"},{default:j((()=>[S(ie,{modelValue:f(L),"onUpdate:modelValue":l[1]||(l[1]=e=>V(L)?L.value=e:L=e)},{default:j((()=>[(k(!0),b(O,null,h(f(P),((e,i)=>(k(),v(oe,{key:i,name:e.code,label:e.label},{default:j((()=>[S(re,{border:!0,column:1},{default:j((()=>[(k(!0),b(O,null,h(e.confs,((i,y)=>(k(),v(ae,{key:y},{label:j((()=>[E("div",C,[E("div",null,[i.required?(k(),b("span",K,"*")):w("",!0),T(" "+x(i.label),1)])])])),default:j((()=>{var y,m,g;return["text"==i.type?(k(),b("div",R,[i.keyFrom?(k(),b("span",D,x(f(ee)[i.keyFrom]?f(ee)[i.keyFrom][i.key]:"--"),1)):(k(),b("span",F,x(f(ee)[i.key]),1))])):"input"==i.type?(k(),b("div",N,[S(t,{class:I({"is-error":i.isError}),onFocus:e=>i.isError=!1,modelValue:f(ee)[i.key],"onUpdate:modelValue":e=>f(ee)[i.key]=e,clearable:"",disabled:pe(e,i)||i.disabled,placeholder:"请输入"+i.label},null,8,["class","onFocus","modelValue","onUpdate:modelValue","disabled","placeholder"]),E("div",z,x(i.subLabel),1)])):"switch"==i.type?(k(),b("div",M,[!f(te).includes(i.key)||1!=(null==(y=f(U).productType)?void 0:y.value)&&2!=(null==(m=f(U).productType)?void 0:m.value)?(k(),v(a,{key:1,modelValue:f(ee)[i.key],"onUpdate:modelValue":e=>f(ee)[i.key]=e},null,8,["modelValue","onUpdate:modelValue"])):(k(),v(r,{key:0,class:"box-item",effect:"dark",content:"当前："+(null==(g=f(U).productType)?void 0:g.displayName)+" 不支持该功能",placement:"top"},{default:j((()=>[S(a,{modelValue:f(ee)[i.key],"onUpdate:modelValue":e=>f(ee)[i.key]=e,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["content"]))])):"picker"==i.type?(k(),b("div",B,[S(o,{modelValue:f(ee)[i.key],"onUpdate:modelValue":e=>f(ee)[i.key]=e},null,8,["modelValue","onUpdate:modelValue"])])):"mlSelectUser"==i.type?(k(),b("div",Y,[S(s,{type:"Role",modelValue:f(ee).nodeRole,"onUpdate:modelValue":l[0]||(l[0]=e=>f(ee).nodeRole=e),clearable:""},null,8,["modelValue"])])):"numInput"==i.type?(k(),b("div",G,[S(n,{modelValue:f(ee)[i.key],"onUpdate:modelValue":e=>f(ee)[i.key]=e,min:1,max:99999,disabled:!f(ee).autoBackup},null,8,["modelValue","onUpdate:modelValue","disabled"]),i.suffixText?(k(),b("span",H,x(i.suffixText),1)):w("",!0)])):"autoSync"==i.type?(k(),b("div",J,[f(ve)?(k(),v(r,{key:0,"popper-class":"conmon-tooltip",effect:"dark",content:f(ve)||"error",placement:"top",style:{width:"300px"}},{default:j((()=>[S(d,{loading:f(be),disabled:pe(e,i),onClick:je},{default:j((()=>[f(be)?w("",!0):(k(),v(u,{key:0},{default:j((()=>[S(p)])),_:1})),X])),_:2},1032,["loading","disabled"])])),_:2},1032,["content"])):(k(),v(d,{key:1,loading:f(be),disabled:pe(e,i),onClick:je},{default:j((()=>[f(be)?w("",!0):(k(),v(u,{key:0},{default:j((()=>[S(p)])),_:1})),Q])),_:2},1032,["loading","disabled"]))])):"uptadeLogo"==i.type?(k(),b("div",W,[S(A,{accept:"image/*",onOnSuccess:ne,class:"ml-upload",uploadUrl:"/picture/upload"},{trigger:j((()=>[f(ee)[i.key]?(k(),b("div",{key:0,class:I(["avatar-box",{"is-error":i.isError}]),onClick:e=>i.isError=!1},[S(c,{class:"avatar",logoUrl:ke(i)},null,8,["logoUrl"])],10,Z)):(k(),v(u,{key:1,onClick:e=>i.isError=!1,class:I(["avatar-uploader-icon",{"is-error":i.isError}])},{default:j((()=>[S(q)])),_:2},1032,["onClick","class"]))])),_:2},1024)])):w("",!0)]})),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["name","label"])))),128))])),_:1},8,["modelValue"]),E("div",$,["authLicense"==f(L)?(k(),v(d,{key:0,type:"primary",style:{width:"100px"},onClick:me},{default:j((()=>[T("激活授权")])),_:1})):(k(),v(d,{key:1,type:"primary",style:{width:"100px"},onClick:ue},{default:j((()=>[T("保存")])),_:1}))])])),_:1})),[[ce,f(le)]]),S(i,{ref_key:"activateAuthRefs",ref:ye,onRegisterActiveConfirm:se},null,512)])}}},[["__scopeId","data-v-dd4d6ed5"]]);export{ee as default};
