import{R as e,r as l,v as a,l as t,Y as i,o as s,i as o,w as n,g as u,c as r,z as m,G as p,E as d,X as c,a as v,F as f,A as j,e as y,t as g,a0 as h,f as b}from"./@vue-1ad4818c.js";import{V as _}from"./vue-draggable-next-a413f884.js";import{_ as C}from"./index-ea085229.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-resize-observer-90aea344.js";const V={class:"clearfix"},k={class:"sortable-box fl"},x={class:"paren-idv"},N={class:"mover fl"},E={class:"action-icon"},z=["onClick"],I=["onClick"],w={class:"fl right-div"},A=["onClick"],S={class:"fl column-item text-ellipsis"},O={class:"fr icon-span"},T={class:"footer-div"},U={style:{"padding-right":"50px"}},q={key:1},D=C({__name:"DetailTabsSet",props:{modelValue:null,entityCode:{type:Number,default:0},entityName:{type:String,default:""},applyType:{type:String,default:"TAB"}},emits:["update:modelValue","confirm"],setup(C,{expose:D,emit:L}){const B=C,J=e("$API"),P=e("$ElMessage");let R=l(!1),G=l(!1),M=l(""),$=l([]),F=l([]),H=l([]),K=l("");const X=()=>K?H.value.filter((e=>{var l;return-1!=(null==(l=e.entityLabel)?void 0:l.indexOf(K.value))})):H.value;let Y=l(!1),Q=a({columnAliasName:"",filter:{equation:"OR",items:[]}});const W=e=>{let{columnAliasName:l,filter:a}=e;return!!(l||(null==a?void 0:a.items.length)>0)},Z=()=>{F.value[Q.columnEditInx]=Object.assign({},Q),Y.value=!1},ee=async()=>{G.value=!0;let e=await J.common.queryEntityList(B.entityCode,!1,!1,!0,!1,!0);e&&e.data&&e.data.length>0&&(H.value=e.data.filter((e=>!$.value.includes(e.entityName)))),G.value=!1},le=async()=>{let e={config:JSON.stringify([...F.value]),entityCode:B.entityCode,applyType:B.applyType};G.value=!0;let l=await J.layoutConfig.saveConfig(M.value,B.applyType,e);l&&(P.success("保存成功！"),R.value=!1,L("confirm",l.data.formData)),G.value=!1};let ae=l(!1),te=l({});const ie=e=>{Q.filter={...e},ae.value=!1};return D({openDialog:e=>{if(M.value=e.layoutConfigId,e.config){let l=JSON.parse(e.config);F.value=[],$.value=[],l.forEach((e=>{F.value.push(e),$.value.push(e.entityName)}))}R.value=!0,ee()}}),(e,l)=>{const a=t("ElIconRank"),D=t("el-icon"),L=t("ElIconEditPen"),B=t("ElIconCloseBold"),J=t("ElIconSearch"),P=t("el-input"),M=t("ElIconPlus"),$=t("el-empty"),ee=t("el-button"),se=t("el-form-item"),oe=t("el-form"),ne=t("mlDialog"),ue=t("mlSetConditions"),re=i("loading");return s(),o(ne,{title:"配置显示项",modelValue:d(R),"onUpdate:modelValue":l[9]||(l[9]=e=>p(R)?R.value=e:R=e),width:"650px"},{footer:n((()=>[u("div",T,[r(ee,{onClick:l[1]||(l[1]=e=>p(R)?R.value=!1:R=!1),loading:d(G)},{default:n((()=>[m("取消")])),_:1},8,["loading"]),r(ee,{type:"primary",onClick:le,loading:d(G)},{default:n((()=>[m("保存")])),_:1},8,["loading"])])])),default:n((()=>[c((s(),v("div",null,[u("div",V,[u("div",k,[r(d(_),{"ghost-class":"ghost","chosen-class":"chosenClass",animation:"300","force-fallback":!1,handle:".mover",list:d(F)},{default:n((()=>[(s(!0),v(f,null,j(d(F),((e,l)=>(s(),v("div",{class:"parent-li",key:l},[u("div",x,[u("div",N,[r(D,{size:"20",class:"icon"},{default:n((()=>[r(a)])),_:1})]),u("div",{class:y(["fl item text-ellipsis",{tag:W(e)}])},g(e.entityLabel),3),u("div",E,[u("span",{class:"icon-span add-icon mr-5",onClick:h((a=>((e,l)=>{Y.value=!0;let a=Object.assign({},e);a.columnAliasName=e.columnAliasName||"",a.columnEditInx=l,Q=Object.assign(Q,a)})(e,l)),["stop"])},[r(D,{size:"15"},{default:n((()=>[r(L)])),_:1})],8,z),u("span",{class:"icon-span",onClick:h((a=>((e,l)=>{F.value.splice(l,1),H.value.push(e)})(e,l)),["stop"])},[r(D,{size:"16"},{default:n((()=>[r(B)])),_:1})],8,I)])])])))),128))])),_:1},8,["list"])]),u("div",w,[r(P,{class:"right-div-input",modelValue:d(K),"onUpdate:modelValue":l[0]||(l[0]=e=>p(K)?K.value=e:K=e),placeholder:"筛选字段",clearable:""},{prefix:n((()=>[r(D,{class:"el-input__icon"},{default:n((()=>[r(J)])),_:1})])),_:1},8,["modelValue"]),X().length>0?(s(),v("div",{key:0,class:y(["source-column-box",{"need-auto":X().length>8}])},[(s(!0),v(f,null,j(X(),((e,l)=>(s(),v("div",{class:"column-li",key:l,onClick:l=>(e=>{F.value.push(e);for(let l=0;l<H.value.length;l++){const a=H.value[l];if(e.entityName==a.entityName)return void H.value.splice(l,1)}})(e)},[u("div",S,g(e.entityLabel),1),u("span",O,[r(D,{size:"16"},{default:n((()=>[r(M)])),_:1})])],8,A)))),128))],2)):(s(),o($,{key:1,"image-size":100,description:"没有数据"}))])])])),[[re,d(G)]]),d(Y)?(s(),o(ne,{key:0,modelValue:d(Y),"onUpdate:modelValue":l[5]||(l[5]=e=>p(Y)?Y.value=e:Y=e),appendToBody:"",title:"显示项设置",width:"510",top:"25vh"},{default:n((()=>[u("div",U,[r(oe,{"label-width":"120px",onSubmit:l[4]||(l[4]=h((()=>{}),["prevent"]))},{default:n((()=>[r(se,{label:"别名"},{default:n((()=>[r(P,{modelValue:d(Q).columnAliasName,"onUpdate:modelValue":l[2]||(l[2]=e=>d(Q).columnAliasName=e)},null,8,["modelValue"])])),_:1}),r(se,null,{default:n((()=>[r(ee,{type:"primary",onClick:Z},{default:n((()=>[m("保存")])),_:1}),r(ee,{onClick:l[3]||(l[3]=e=>p(Y)?Y.value=!1:Y=!1)},{default:n((()=>[m("取消")])),_:1})])),_:1})])),_:1})])])),_:1},8,["modelValue"])):b("",!0),d(ae)?(s(),v("div",q,[r(ne,{title:"附加过滤条件","append-to-body":"",width:"37%",modelValue:d(ae),"onUpdate:modelValue":l[8]||(l[8]=e=>p(ae)?ae.value=e:ae=e)},{default:n((()=>[r(ue,{modelValue:d(te),"onUpdate:modelValue":l[6]||(l[6]=e=>p(te)?te.value=e:te=e),footer:"",onCancel:l[7]||(l[7]=e=>p(ae)?ae.value=!1:ae=!1),onConfirm:ie,entityName:C.entityName},null,8,["modelValue","entityName"])])),_:1},8,["modelValue"])])):b("",!0)])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-1afeb79e"]]);export{D as default};
