import{_ as e}from"./index-ea085229.js";import{R as l,r as a,u as t,p as i,l as u,o as s,i as d,w as o,c as n,z as r,G as c,g as m,E as f,a as y,F as p,A as v,t as g}from"./@vue-1ad4818c.js";const k={class:"mlfield-box"},C={class:"mlfield-item"},Q={class:"mlfield-check-box fl"},S=["onClick"],V=e({__name:"index",props:{modelValue:{type:Object,default:()=>{}},title:{type:String,defalut:"123"},nameFieldName:{type:String,defalut:"123"},isQuickQuery:{type:Boolean,defalut:!1},quickQueryConf:{type:Object,default:()=>{}},entityName:{type:String,defalut:"DemoContact"}},emits:["update:modelValue","onConfirm"],setup(e,{expose:V,emit:b}){const h=e,_=l("$API"),E=l("$ElMessage");let x=a([]),w=a(!1),R=a(!1),q=a([]);t((()=>h.modelValue),(()=>{x.value=h.modelValue}),{deep:!0}),i((()=>{x.value=h.modelValue}));const F=async()=>{R.value=!0;let e,l={entity:h.entityName},a=x.value.map((e=>e.name));if(h.isQuickQuery?(l.queryReference=!1,e=await _.common.getFieldListOfFilter(l)):e=await _.common.getFieldListOfEntity(l),e){let l=[];e.data.forEach((e=>{if("PrimaryKey"!==e.type){if(e.isSelected=!1,a.includes(e.name)){let l=x.value.filter((l=>e.name==l.name));e.isRequired=l[0].isRequired,e.isEdit=l[0].isEdit,e.isSelected=!0}h.isQuickQuery&&x.value.length<1&&e.name==h.nameFieldName&&(e.isSelected=!0),l.push(e)}})),q.value=l}R.value=!1},N=async()=>{if(x.value=q.value.filter((e=>e.isSelected)),x.value.forEach((e=>{e.isEdit=!0,e.isRequired=!1})),h.isQuickQuery){if(x.value.length<1)return void E.warning("请至少选择 1 个搜索字段");let{entityCode:e,layoutConfigId:l}=h.quickQueryConf,a={config:JSON.stringify([...x.value]),entityCode:e,applyType:"SEARCH"};R.value=!0,await _.layoutConfig.saveConfig(l,"SEARCH",a)&&(E.success("保存成功！"),w.value=!1,b("onConfirm")),R.value=!1}else b("update:modelValue",x.value),w.value=!1};return V({openDialg:()=>{w.value=!0,F()}}),(l,a)=>{const t=u("el-checkbox"),i=u("el-col"),V=u("el-row"),b=u("el-scrollbar"),_=u("el-empty"),E=u("el-button"),x=u("mlDialog");return s(),d(x,{title:e.title,"append-to-body":"",width:"38%",modelValue:f(w),"onUpdate:modelValue":a[1]||(a[1]=e=>c(w)?w.value=e:w=e)},{footer:o((()=>[n(E,{type:"primary",onClick:N},{default:o((()=>[r("确认")])),_:1}),n(E,{onClick:a[0]||(a[0]=e=>c(w)?w.value=!1:w=!1)},{default:o((()=>[r("取消")])),_:1})])),default:o((()=>[m("div",k,[f(q).length>0?(s(),d(b,{key:0,"max-height":"400px"},{default:o((()=>[n(V,null,{default:o((()=>[(s(!0),y(p,null,v(f(q),((l,a)=>(s(),d(i,{span:e.isQuickQuery?8:6,key:a},{default:o((()=>[m("div",C,[m("div",Q,[n(t,{modelValue:l.isSelected,"onUpdate:modelValue":e=>l.isSelected=e,disabled:!e.isQuickQuery&&l.reserved},null,8,["modelValue","onUpdate:modelValue","disabled"])]),m("div",{class:"mlfield-label fr",onClick:e=>(e=>{e.reserved&&!h.isQuickQuery||(e.isSelected=!e.isSelected)})(l)},g(l.label),9,S)])])),_:2},1032,["span"])))),128))])),_:1})])),_:1})):(s(),d(_,{key:1,description:"没有数据"}))])])),_:1},8,["title","modelValue"])}}},[["__scopeId","data-v-d6579530"]]);export{V as m};
