import{R as l,r as e,u as o,p as a,v as s,l as t,Y as i,o as n,i as u,w as m,g as r,c,z as d,G as p,E as v,X as f,a as j,F as g,A as h,e as C,t as y,a0 as b,f as _}from"./@vue-1ad4818c.js";import{V as S}from"./vue-draggable-next-a413f884.js";import{_ as x,n as V}from"./index-ea085229.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-resize-observer-90aea344.js";const k={class:"clearfix"},E={class:"sortable-box fl"},I={class:"paren-idv"},N={class:"mover fl"},A={class:"action-icon"},z=["onClick"],w=["onClick"],D={class:"fl right-div"},O=["onClick"],W={class:"fl column-item text-ellipsis"},T={class:"fr icon-span"},L={class:"footer-div"},U={class:"info-text ml-10"},B=x({__name:"SetColumn",props:{modelValue:null,editColumnDialog:{type:Object,default:()=>{}}},emits:["update:modelValue","confirm"],setup(x,{emit:B}){const q=x,J=l("$API"),P=l("$ElMessage");let G=e(!1),M=e(!1);o((()=>G.value),(l=>{B("update:modelValue",l)}),{deep:!0}),a((()=>{G.value=q.modelValue,ll()}));let R=e([]),$=e([]),F=e("");const H=()=>F?$.value.filter((l=>-1!=l.fieldLabel.indexOf(F.value))):$.value;let K=e(!1),X=s({columnWidth:0,columnSort:"",columnAliasName:""});const Y=()=>{""==X.columnSort?X.columnSort="DESC":"DESC"==X.columnSort?X.columnSort="ASC":X.columnSort=""},Q=l=>{let{columnAliasName:e,columnSort:o,columnWidth:a}=l;return!!(e||o||a>0)},Z=()=>{Object.assign({},R.value[X.columnEditInx]).columnSort!=X.columnSort&&R.value.forEach((l=>{l.columnSort=""})),R.value[X.columnEditInx]=Object.assign({},X),K.value=!1},ll=async()=>{M.value=!0;let l=await V(q.editColumnDialog.entityCode,!0,!1,!0);if(l){R.value=[];let e=[];q.editColumnDialog.config&&JSON.parse(q.editColumnDialog.config).forEach((l=>{R.value.push(l),e.push(l.fieldName)})),$.value=l.data.filter((l=>!e.includes(l.fieldName)))}M.value=!1},el=async()=>{if(R.value.length<1)return void P.warning("请至少选择 1 个列显示");let{entityCode:l,applyType:e,shareTo:o,layoutConfigId:a}=q.editColumnDialog,s={config:JSON.stringify([...R.value]),entityCode:l,applyType:e,shareTo:o};M.value=!0,await J.layoutConfig.saveConfig(a,"LIST",s)&&(P.success("保存成功！"),G.value=!1,B("confirm")),M.value=!1};return(l,e)=>{const o=t("ElIconRank"),a=t("el-icon"),s=t("ElIconEditPen"),x=t("ElIconCloseBold"),V=t("ElIconSearch"),B=t("el-input"),q=t("ElIconPlus"),J=t("el-button"),P=t("el-form-item"),ll=t("el-input-number"),ol=t("ElIconTop"),al=t("ElIconBottom"),sl=t("el-form"),tl=t("mlDialog"),il=i("loading");return n(),u(tl,{title:"设置列显示",modelValue:v(G),"onUpdate:modelValue":e[6]||(e[6]=l=>p(G)?G.value=l:G=l),width:"650px"},{footer:m((()=>[r("div",L,[c(J,{onClick:e[1]||(e[1]=l=>p(G)?G.value=!1:G=!1),loading:v(M)},{default:m((()=>[d("取消")])),_:1},8,["loading"]),c(J,{type:"primary",onClick:el,loading:v(M)},{default:m((()=>[d("保存")])),_:1},8,["loading"])])])),default:m((()=>[f((n(),j("div",null,[r("div",k,[r("div",E,[c(v(S),{"ghost-class":"ghost","chosen-class":"chosenClass",animation:"300","force-fallback":!1,handle:".mover",list:v(R)},{default:m((()=>[(n(!0),j(g,null,h(v(R),((l,e)=>(n(),j("div",{class:"parent-li",key:e},[r("div",I,[r("div",N,[c(a,{size:"20",class:"icon"},{default:m((()=>[c(o)])),_:1})]),r("div",{class:C(["fl item text-ellipsis",{tag:Q(l)}])},y(l.fieldLabel),3),r("div",A,[r("span",{class:"icon-span add-icon mr-5",onClick:b((o=>((l,e)=>{K.value=!0;let o=Object.assign({},l);o.columnAliasName=l.columnAliasName||"",o.columnSort=l.columnSort||"",o.columnWidth=l.columnWidth||0,o.columnEditInx=e,X=Object.assign(X,o)})(l,e)),["stop"])},[c(a,{size:"15"},{default:m((()=>[c(s)])),_:1})],8,z),r("span",{class:"icon-span",onClick:b((o=>((l,e)=>{R.value.splice(e,1),$.value.push(l)})(l,e)),["stop"])},[c(a,{size:"16"},{default:m((()=>[c(x)])),_:1})],8,w)])])])))),128))])),_:1},8,["list"])]),r("div",D,[c(B,{class:"right-div-input",modelValue:v(F),"onUpdate:modelValue":e[0]||(e[0]=l=>p(F)?F.value=l:F=l),placeholder:"筛选字段",clearable:""},{prefix:m((()=>[c(a,{class:"el-input__icon"},{default:m((()=>[c(V)])),_:1})])),_:1},8,["modelValue"]),r("div",{class:C(["source-column-box",{"need-auto":H().length>8}])},[(n(!0),j(g,null,h(H(),((l,e)=>(n(),j("div",{class:"column-li",key:e,onClick:e=>(l=>{R.value.push(l);for(let e=0;e<$.value.length;e++){const o=$.value[e];if(l.fieldName==o.fieldName)return void $.value.splice(e,1)}})(l)},[r("div",W,y(l.fieldLabel),1),r("span",T,[c(a,{size:"16"},{default:m((()=>[c(q)])),_:1})])],8,O)))),128))],2)])])])),[[il,v(M)]]),v(K)?(n(),u(tl,{key:0,modelValue:v(K),"onUpdate:modelValue":e[5]||(e[5]=l=>p(K)?K.value=l:K=l),appendToBody:"",title:"列设置",width:"450",top:"25vh"},{default:m((()=>[c(sl,{"label-width":"120px"},{default:m((()=>[c(P,{label:"别名"},{default:m((()=>[c(B,{modelValue:v(X).columnAliasName,"onUpdate:modelValue":e[2]||(e[2]=l=>v(X).columnAliasName=l)},null,8,["modelValue"])])),_:1}),c(P,{label:"默认宽度"},{default:m((()=>[c(ll,{modelValue:v(X).columnWidth,"onUpdate:modelValue":e[3]||(e[3]=l=>v(X).columnWidth=l),min:0,max:500,"controls-position":"right",step:10},null,8,["modelValue"]),r("span",U,y(v(X).columnWidth>0?"宽度 "+v(X).columnWidth:"默认"),1)])),_:1}),c(P,{label:"默认排序"},{default:m((()=>[r("span",{class:C(["sort-span",{"is-active":""!=v(X).columnSort}]),onClick:Y},[d(y("ASC"==v(X).columnSort?"升序":"降序")+" ",1),c(a,{class:"sort-icon"},{default:m((()=>["ASC"==v(X).columnSort?(n(),u(ol,{key:0})):(n(),u(al,{key:1}))])),_:1})],2)])),_:1}),c(P,null,{default:m((()=>[c(J,{type:"primary",onClick:Z},{default:m((()=>[d("保存")])),_:1}),c(J,{onClick:e[4]||(e[4]=l=>p(K)?K.value=!1:K=!1)},{default:m((()=>[d("取消")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])):_("",!0)])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-df7e2e72"]]);export{B as default};
