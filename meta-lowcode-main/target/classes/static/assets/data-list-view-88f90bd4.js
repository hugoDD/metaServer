import{F as e,e as t}from"./event-bus-08647060.js";import{_ as a,i as s,c as i,u as o,s as r,d as l,a as d,g as n,b as h,e as m}from"./index-ea085229.js";import{l as c,o as p,i as u,w as g,c as y,g as f,C as b,ag as j,z as D,t as F,f as $,bh as v,bf as C}from"./@vue-1ad4818c.js";import"./mitt-f0e54764.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";const w={name:"DataList",props:{entity:String,customAddAction:{type:Boolean,default:!1},customEditAction:{type:Boolean,default:!1},customDeleteAction:{type:Boolean,default:!1},customDataLoad:{type:Boolean,default:!1},page:{type:Object,default:()=>({pageNo:1,limit:20,sizes:[10,20,30,50,100],total:0})},crudMethods:{type:Object,default:()=>({initDataList:s,createRecord:i,updateRecord:o,saveRecord:r,deleteRecord:l})}},data:()=>({entityLabel:"",idFieldName:null,nameFieldName:null,curRecordId:null,keyword:"",searchFilter:"",columns:[],tableData:[],showFormDialogFlag:!1,layout:{},formState:1,formModel:{},labelsModel:{},fieldPropsMap:{},tableHeight:200}),computed:{formTitle(){return this.formState===e.NEW?"新建"+this.entityLabel:this.formState===e.EDIT?"编辑"+this.entityLabel:this.entityLabel+"详情"}},mounted(){this.$nextTick((()=>{this.resizeTableHeight()})),window.onresize=()=>{this.resizeTableHeight()},this.initTable()},methods:{resizeTableHeight(){this.$refs.tableContainer&&this.$refs.tableContainer.$el&&(this.tableHeight=this.$refs.tableContainer.$el.offsetHeight-42)},initTable(){this.entity?!0!==this.customDataLoad&&this.crudMethods.initDataList(this.entity).then((e=>{null==e.error?(this.setTableData(e.data.columnList,e.data.dataList),this.page.total=e.data.pagination.total,this.entityLabel=e.data.entityBasicInfo.label,this.idFieldName=e.data.entityBasicInfo.idField,e.data.entityBasicInfo.nameField&&(this.nameFieldName=e.data.entityBasicInfo.nameField)):this.$message({message:e.error,type:"error"})})).catch((e=>{this.$message({message:e.message,type:"error"})})):this.$message.error("entity of prop is null")},setTableData(e,t){this.columns=e,this.columns.forEach((e=>{d(e)})),this.tableData=t},loadTableData(e){let t=m(e)?"(1=1)":e,a="";this.columns.forEach((e=>{a+=e.prop+","})),n(this.entity,a,t,this.page.limit,this.page.pageNo).then((e=>{null!=e.error?this.$message({message:e.error,type:"error"}):(this.tableData=e.data.dataList,this.page.total=e.data.pagination.total)})).catch((e=>{this.$message({message:e.message,type:"error"})}))},handleSizeChange(e){!0!==this.customDataLoad?(this.page.limit=e,this.page.pageNo=1,this.loadTableData(this.searchFilter)):this.$emit("handleSizeChange",e)},handleCurrentChange(e){!0!==this.customDataLoad?(this.page.pageNo=e,this.loadTableData(this.searchFilter)):this.$emit("handleCurrentChange",e)},searchData(){if(!0===this.customDataLoad)return void this.$emit("searchData",this.keyword);if(!this.nameFieldName)return void this.$message.error("当前实体["+this.entity+"]未指定名称字段，不能搜索！");let e=this.nameFieldName,t=this.keyword;this.searchFilter=`([${e}] like '%${t}%')`,this.loadTableData(this.searchFilter)},clearSearch(){if(!0===this.customDataLoad)return this.keyword="",void this.$emit("clearSearch");this.searchFilter="",this.loadTableData()},refreshTableData(){!0!==this.customDataLoad?this.loadTableData(this.searchFilter):this.$emit("refreshTable")},addNewRecord(){!0!==this.customAddAction?this.crudMethods.createRecord(this.entity).then((t=>{null==t.error?t.data&&t.data.layoutJson?(this.curRecordId=null,this.layout=this.buildLayoutObj(),this.layout.setLayoutPropsFromServer(t),this.handleDeletedFields(t),this.formModel=t.data.formData,this.labelsModel=t.data.labelData,this.fieldPropsMap=t.data.fieldPropsMap,this.formState=e.NEW,this.showFormDialogFlag=!0,this.$refs.formWidget&&this.$refs.formWidget.clearFormValidate()):this.$message({message:"加载表单布局出错",type:"error"}):this.$message({message:t.error,type:"error"})})).catch((e=>{this.$message({message:e.message,type:"error"})})):this.$emit("addTableRecord")},buildLayoutObj:()=>createLayoutObj(t),handleDeletedFields(e){let t=e.data.deletedFields;if(t&&Array.isArray(t)){let e=this.layout.getAllLayoutFieldWrappers();e&&Array.isArray(e)&&e.forEach((e=>{h(t,e.name)&&(e.deleted=!0)}))}},editTableData(t){!0!==this.customEditAction?(this.curRecordId=t[this.idFieldName],this.crudMethods.updateRecord(this.entity,this.curRecordId).then((t=>{null==t.error?t.data&&t.data.layoutJson?(this.layout=this.buildLayoutObj(),this.layout.setLayoutPropsFromServer(t),this.handleDeletedFields(t),this.formModel=t.data.formData,this.labelsModel=t.data.labelData,this.fieldPropsMap=t.data.fieldPropsMap,this.formState=e.EDIT,this.showFormDialogFlag=!0,this.$refs.formWidget&&this.$refs.formWidget.clearFormValidate()):this.$message({message:"加载表单布局出错",type:"error"}):this.$message({message:t.error,type:"error"})})).catch((e=>{this.$message({message:e.message,type:"error"})}))):this.$emit("editTableRow",t)},saveFormData(){let t=!1;this.$refs.formWidget.validateForm((e=>{if(t=e,!e)return!1})),t&&this.crudMethods.saveRecord(this.entity,this.formState===e.NEW?"":this.curRecordId,this.formModel).then((e=>{null==e.error?(this.formModel=e.data.formData,this.labelsModel=e.data.labelData,this.$message({message:"保存成功",type:"success"}),this.showFormDialogFlag=!1,this.loadTableData(this.searchFilter)):this.$message({message:e.error,type:"error"})})).catch((e=>{this.$message({message:e.message,type:"error"})}))},deleteTableData(e){!0!==this.customDeleteAction?this.$confirm("是否删除该数据?","删除确认").then((()=>{this.crudMethods.deleteRecord(e[this.idFieldName]).then((e=>{null==e.error?(this.$message.success("删除成功"),this.loadTableData(this.searchFilter)):this.$message({message:e.error,type:"error"})})).catch((e=>{this.$message({message:e.message,type:"error"})}))})).catch((()=>{this.$message.info("取消删除")})):this.$emit("deleteTableRow",e)}}},T={class:"search-panel-left"},L=(e=>(v("data-v-d869c36e"),e=e(),C(),e))((()=>f("div",{style:{flex:"1"}},null,-1))),k={class:"search-panel-right"},M={style:{height:"100%"}},z={class:"dialog-footer"};const N=a({name:"DataListView",components:{DataList:a(w,[["render",function(e,t,a,s,i,o){const r=c("el-button"),l=c("el-input"),d=c("el-header"),n=c("SimpleTable"),h=c("v-form-render"),m=c("el-dialog"),v=c("el-main"),C=c("el-container");return p(),u(C,null,{default:g((()=>[y(d,{class:"list-search-panel"},{default:g((()=>[f("div",T,[b(e.$slots,"listTitle",{},void 0,!0)]),L,f("div",k,[y(l,{type:"primary",placeholder:"请输入关键词搜索",clearable:!0,modelValue:i.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>i.keyword=e),onKeyup:j(o.searchData,["enter"]),onClear:o.clearSearch,"suffix-icon":"el-icon-search"},{append:g((()=>[y(r,{icon:"el-icon-refresh-right",onClick:o.refreshTableData,title:"刷新"},null,8,["onClick"])])),_:1},8,["modelValue","onKeyup","onClear"]),y(r,{type:"primary",icon:"el-icon-plus",onClick:o.addNewRecord},{default:g((()=>[D("新建"+F(i.entityLabel),1)])),_:1},8,["onClick"])])])),_:3}),y(v,{ref:"tableContainer",class:"table-container"},{default:g((()=>[f("div",M,[y(n,{columns:i.columns,data:i.tableData,pagination:a.page,"show-check-box":!0,height:i.tableHeight+"px",onHandleSizeChange:o.handleSizeChange,onHandleCurrentChange:o.handleCurrentChange,"show-operation-column":!0,"table-width":"100% !important"},{table_operation:g((({scope:e})=>[y(r,{link:"",type:"primary",size:"small",icon:"el-icon-edit",onClick:t=>o.editTableData(e.row)},{default:g((()=>[D("修改 ")])),_:2},1032,["onClick"]),y(r,{link:"",type:"primary",size:"small",icon:"el-icon-delete",onClick:t=>o.deleteTableData(e.row)},{default:g((()=>[D("删除 ")])),_:2},1032,["onClick"])])),_:1},8,["columns","data","pagination","height","onHandleSizeChange","onHandleCurrentChange"])]),i.showFormDialogFlag?(p(),u(m,{key:0,title:o.formTitle,modelValue:i.showFormDialogFlag,"onUpdate:modelValue":t[2]||(t[2]=e=>i.showFormDialogFlag=e),"destroy-on-close":!0,"close-on-click-modal":!1,"show-close":!0,"close-on-press-escape":!1},{footer:g((()=>[f("div",z,[y(r,{type:"primary",onClick:o.saveFormData,style:{width:"90px"}},{default:g((()=>[D("保 存")])),_:1},8,["onClick"]),y(r,{onClick:t[1]||(t[1]=e=>i.showFormDialogFlag=!1)},{default:g((()=>[D("取 消")])),_:1})])])),default:g((()=>[y(h,{ref:"formWidget"},null,512)])),_:1},8,["title","modelValue"])):$("",!0)])),_:1},512)])),_:3})}],["__scopeId","data-v-d869c36e"]])},data:()=>({entity:""}),created(){this.entity=this.$route.query.entity}},[["render",function(e,t,a,s,i,o){const r=c("data-list"),l=c("el-container");return p(),u(l,{direction:"horizontal"},{default:g((()=>[y(r,{entity:i.entity},null,8,["entity"])])),_:1})}],["__scopeId","data-v-2639be19"]]);export{N as default};
