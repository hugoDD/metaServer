import{f as e,aB as t,$ as r,j as o}from"./index-ea085229.js";import{s as a}from"./pinia-3f60a8e1.js";import{u as s}from"./vue-router-414ebc36.js";import{D as i}from"./detail-5eb8c530.js";import{m as l}from"./ApprovalRelated-e5fb019d.js";import{R as m,r as p,l as n,o as d,a as u,c as j,w as c,z as f,E as v,G as y,f as g,F as b}from"./@vue-1ad4818c.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./nprogress-c04e6182.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";import"./DetailTabs-e3a61e27.js";import"./DetailTabsSet-9cda58dd.js";import"./More-47f7037c.js";import"./SetColumn-15f4404b.js";import"./DataExport-cabbbed3.js";import"./Allocation-359987ff.js";import"./ReportForms-7661dfe6.js";import"./DefaultFilterDialog-f7a53bd1.js";import"./FormatRow-d4305ec1.js";import"./edit-dfd0882d.js";import"./team-3e46d8bc.js";import"./NewRelated-d601bf33.js";import"./CardLayout-74c0bddb.js";const w={key:0},N={__name:"index",setup(N){const{unSystemEntityList:h}=a(e()),{newMsgNum:R}=a(t()),{setNewMsgNum:C}=t(),I=m("COMMON_CONFIG"),O=m("$ElMessage"),k=m("$TOOL"),x=s();let D=p([{fieldName:"createdOn",type:"DESC"}]),E=p([{fieldName:"toUser",op:"EQ",value:k.data.get("USER_INFO").userId}]),_=p([{prop:"message",label:"消息"},{prop:"relatedRecord.name",label:"相关记录",formatter:e=>{var t;return null==(t=e.relatedRecord)?void 0:t.name}},{prop:"fromUser.name",label:"发送人",width:"120",align:"center",formatter:e=>{var t;return null==(t=e.fromUser)?void 0:t.name}},{prop:"type",label:"消息分类",width:"120",align:"center",formatter:e=>I.notificationType[e.type]},{prop:"unread",label:"是否已读",width:"100",align:"center",formatter:e=>e.unread?"否":"是"},{prop:"createdOn",label:"创建时间",width:"120",align:"center",formatter:e=>r(e.createdOn)}]),z=p(""),F=p(!1),M=p(""),U=p(""),L=p("");const S=e=>{e.unread=!1;let t=R.value;C(t-1),o.post("/note/read?id="+e.notificationId)},q=()=>{o.post("/note/readAll"),C(0)};return(e,t)=>{const r=n("el-button"),o=n("el-table-column"),a=n("mlSingleList");return d(),u(b,null,[j(a,{title:"消息中心",mainEntity:"Notification",fieldsList:"fromUser,unread,type,relatedRecord,message,createdOn",sortFields:v(D),fieldName:"message",tableColumn:v(_),filterItems:v(E),queryUrl:"/note/listQuery"},{addbutton:c((()=>[j(r,{type:"primary",onClick:q},{default:c((()=>[f("全部设为已读")])),_:1})])),activeRow:c((()=>[j(o,{label:"操作",align:"center",width:"100",fixed:"right"},{default:c((e=>[j(r,{type:"primary",size:"small",link:"",onClick:t=>(e=>{10==e.type?(F.value=!0,M.value=e.relatedRecord.id,U.value=e.relatedRecord.id,L.value=e.relatedRecord.name):11==e.type?x.push("/web/center-cc"):h.value.filter((t=>t.name==e.entityName)).length<1?O.error("该实体已删除"):z.value.openDialog(e.relatedRecord.id);e.unread&&S(e)})(e.row)},{default:c((()=>[f("查看")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["sortFields","tableColumn","filterItems"]),j(i,{ref_key:"detailRefs",ref:z},null,512),v(F)?(d(),u("div",w,[j(l,{modelValue:v(F),"onUpdate:modelValue":t[0]||(t[0]=e=>y(F)?F.value=e:F=e),taskId:v(M),entityId:v(U),approvalName:v(L),title:"审批"},null,8,["modelValue","taskId","entityId","approvalName"])])):g("",!0)],64)}}};export{N as default};
