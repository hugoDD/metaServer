import e from"./AddMembers-0d41fc5e.js";import a from"./TabMemberList-d965ffd7.js";import s from"./edit-dfd0882d.js";import{_ as t,f as l,B as r,C as i,j as o}from"./index-ea085229.js";import{d as m,g as n}from"./team-3e46d8bc.js";import{b as d,a as p}from"./element-plus-bab58d46.js";import{R as u,r as c,l as j,o as f,a as v,c as b,w as g,E as y,G as _,z as w,i as h,f as T,g as x,F as k}from"./@vue-1ad4818c.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";const D=["onClick"],C={key:1},N=t({__name:"ListDetail",props:{idFieldName:{type:String,default:""},nameFieldName:{type:String,default:""}},emits:["onRefresh"],setup(t,{expose:N,emit:U}){const R=t,z=u("$TOOL");let I=c();const{queryEntityNameById:V}=l();let F=c(""),L=c("");const M=()=>{I.value.refresh(),U("onRefresh")};let B=c([]);const A=()=>{I.value.refresh()},E=async e=>{let a;I.value.loading=!0,B.value=[],a="Team"==L.value?await n(e.id):await i(e.id),a&&("Team"==L.value?B.value=a.data||[]:B.value=a.data.data||[]),I.value.loading=!1},q=e=>{let a="Team"==L.value?24:21;return z.checkRole("r"+a+"-"+e)};let O=c();let S=c(!1),$=c(""),G=c("");const K=()=>{G.value="xxxcxxx".replace(/[xy]/g,(function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)}))},Z=async()=>{if(!G.value)return void p.error("请输入密码");if(!/(?=.*([a-zA-Z].*))(?=.*[0-9].*)[a-zA-Z0-9-*/+.~!@#$%^&*()]{6,20}$/.test(G.value))return void p.error("必须包含数字、英文。可有字符。密码长度为：6-20位");let e=await o.get("/user/resetPassword",{password:G.value,userId:$.value});e&&200==e.code&&(p.success("重置成功"),G.value="",S.value=!1,M())};return N({openDetailDialog:(e,a)=>{L.value=V(e),F.value=e,I.value.openDialog({title:a,id:e,tabs:[{label:"Team"==L.value?"成员列表":"角色列表",name:"memberList"}]})}}),(l,i)=>{const o=j("el-col"),n=j("el-button"),u=j("ElIconMoreFilled"),c=j("el-icon"),N=j("el-dropdown-item"),z=j("el-dropdown-menu"),V=j("el-dropdown"),H=j("el-row"),J=j("mlListDetails"),P=j("el-input"),Q=j("ml-dialog");return f(),v(k,null,[b(J,{ref_key:"mlListDetailsRefs",ref:I,onTabChange:E},{tab:g((()=>[b(a,{modelValue:y(B),"onUpdate:modelValue":i[0]||(i[0]=e=>_(B)?B.value=e:B=e),onDelMembers:A,id:y(F),isRole:"User"==y(L),isDisabled:!q(4)},null,8,["modelValue","id","isRole","isDisabled"])])),operate:g((({row:a})=>[b(H,{class:"action-group"},{default:g((()=>[b(o,{span:24},{default:g((()=>[b(e,{onAddMembers:A,paramId:y(F),paramName:"Team"==y(L)?"成员":"角色",paramType:"Team"==y(L)?"User":"Role",isDisabled:!q(3)},null,8,["paramId","paramName","paramType","isDisabled"])])),_:1}),b(o,{span:24},{default:g((()=>[b(n,{icon:"Edit",onClick:e=>(e=>{let a={};a.detailId=e[R.idFieldName],O.value.openDialog(a)})(a),disabled:!q(3)},{default:g((()=>[w("编辑")])),_:2},1032,["onClick","disabled"])])),_:2},1024),"User"==y(L)?(f(),h(o,{key:0,span:24},{default:g((()=>[b(n,{icon:"Key",onClick:e=>(e=>{S.value=!0,$.value=e.userId,G.value=""})(a),disabled:!q(3)},{default:g((()=>[w("重置密码")])),_:2},1032,["onClick","disabled"])])),_:2},1024)):T("",!0),b(o,{span:24},{default:g((()=>[b(V,{trigger:"click"},{dropdown:g((()=>[b(z,null,{default:g((()=>[b(N,{disabled:!q(4)},{default:g((()=>[q(4)?(f(),v("span",{key:0,onClick:e=>{return s=a[t.idFieldName],void d.confirm("是否确认删除?","提示：",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{let e;if("Team"==L.value)e=await m(s);else{if("021-000000000000000000000000000000000001"===s)return void p.info("管理员用户禁止删除！");e=await r(s)}e&&(p.success("删除成功"),I.value.closeDialog(),U("onRefresh"))})).catch((()=>{}));var s}},"删除",8,D)):(f(),v("span",C,"删除"))])),_:2},1032,["disabled"])])),_:2},1024)])),default:g((()=>[b(n,null,{default:g((()=>[w(" 更多 "),b(c,{style:{transform:"rotate(90deg)"}},{default:g((()=>[b(u)])),_:1})])),_:1})])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1},512),b(s,{ref_key:"editRefs",ref:O,onOnConfirm:M,isTeam:"Team"==y(L),isUser:"User"==y(L),nameFieldName:"User"==y(L)?"UserName":"TeamName"},null,8,["isTeam","isUser","nameFieldName"]),b(Q,{title:"重置密码",modelValue:y(S),"onUpdate:modelValue":i[3]||(i[3]=e=>_(S)?S.value=e:S=e),appendToBody:"",width:"450px"},{footer:g((()=>[b(n,{onClick:i[2]||(i[2]=e=>_(S)?S.value=!1:S=!1)},{default:g((()=>[w("取消")])),_:1}),b(n,{type:"primary",onClick:Z},{default:g((()=>[w("确定")])),_:1})])),default:g((()=>[b(P,{modelValue:y(G),"onUpdate:modelValue":i[1]||(i[1]=e=>_(G)?G.value=e:G=e),placeholder:"输入密码",clearable:""},{append:g((()=>[x("span",{class:"generate-pwd",onClick:K},"生成随机密码")])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])],64)}}},[["__scopeId","data-v-5691ae1d"]]);export{N as default};
