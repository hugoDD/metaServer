import{_ as a,f as e,k as t,h as l,q as i,l as o,m as s,s as d}from"./index-ea085229.js";import{s as r}from"./team-3e46d8bc.js";import{R as m,v as p,r as n,l as u,Y as v,E as f,o as y,i as j,w as c,c as N,z as g,G as b,f as I,X as U,a as w,n as S}from"./@vue-1ad4818c.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";const h={class:"main"},k={key:0,class:"info-box"},x={key:1,class:"info-box"},D=a({__name:"edit",props:{isTeam:{type:Boolean,default:!1},isUser:{type:Boolean,default:!1},disableWidgets:{type:Array,default:()=>[]},nameFieldName:{type:String,default:""}},emits:["onConfirm"],setup(a,{expose:D,emit:L}){const P=a,{queryEntityNameById:T,queryEntityNameByLabel:F}=e(),_=m("$ElMessage");let z=p({approvalStatus:{},detailId:"",entityName:"",fieldName:"",fieldNameLabel:"",fieldNameVale:""});const J=n({});J.value.uploadServer="";let V=n({}),E=n(!1),q=n(!1);const R=n();let B=n(!1);const C=async()=>{var a;E.value=!0,J.value.formEntity=z.entityName;let e=await l(z.entityName);e&&(null==(a=e.data)?void 0:a.layoutJson)&&(B.value=!0,V.value=e.data.optionData||{},e.data.formUploadParam&&(J.value.cloudUploadToken=e.data.formUploadParam.cloudUploadToken,J.value.cloudStorage=e.data.formUploadParam.cloudStorage,J.value.picUploadURL=e.data.formUploadParam.picUploadURL,J.value.fileUploadURL=e.data.formUploadParam.fileUploadURL,J.value.picDownloadPrefix=e.data.formUploadParam.picDownloadPrefix,J.value.fileDownloadPrefix=e.data.formUploadParam.fileDownloadPrefix),z.detailId?S((async()=>{let a=await i(z.detailId);R.value.setFormJson(e.data.layoutJson),a&&a.data&&(z.dialogTitle="编辑"+a.data[P.nameFieldName],z.approvalStatus=a.data.approvalStatus||{},R.value.setFormData(a.data),S((()=>{"{}"==JSON.stringify(V.value)&&R.value.reloadOptionData(),1!=z.approvalStatus.value&&3!=z.approvalStatus.value?W("updatable"):R.value.disableForm()}))),E.value=!1})):S((async()=>{z.dialogTitle="新建"+F(z.entityName),R.value.setFormJson(e.data.layoutJson);let a={};z.fieldName&&(a[z.fieldName]={id:z.fieldNameVale,name:z.fieldNameLabel}),R.value.setFormData(a),S((()=>{z.fieldName&&R.value.disableWidgets([z.fieldName]),"{}"==JSON.stringify(V.value)&&R.value.reloadOptionData(),W("creatable")}))}))),E.value=!1},W=async a=>{let e=await o(z.entityName),t=[];e&&e.data&&e.data.forEach((e=>{e[a]||t.push(e.name)})),P.disableWidgets.length>0&&t.push(...P.disableWidgets),R.value.disableWidgets(t)},O=async()=>{var a;if(!R.value)return void(q.value=!1);let e=await R.value.getFormData();if(z.fieldName&&(e[z.fieldName]={id:z.fieldNameVale,name:z.fieldNameLabel}),e){let t;E.value=!0,t=P.isTeam?await r(z.entityName,z.detailId,e):P.isUser?await s(z.entityName,z.detailId,e):await d(z.entityName,z.detailId,e),!t||200!=(null==(a=t.data)?void 0:a.code)&&200!=t.code||(_.success("保存成功"),L("onConfirm"),q.value=!1),E.value=!1}};return D({openDialog:async a=>{z.dialogTitle="Loading...",z.detailId=a.detailId,z.entityName=a.detailId?T(a.detailId):a.entityName,z.fieldName=a.fieldName,z.fieldNameLabel=a.fieldNameLabel,z.fieldNameVale=a.fieldNameVale;let e={id:a.detailId,rightType:a.detailId?3:2,entityName:a.detailId?"":a.entityName},l=await t(e.id,e.rightType,e.entityName);l.data&&200==l.data.code&&l.data.data?(q.value=!0,C()):_.error("当前用户没有"+(a.detailId?"编辑":"新建")+"权限")}}),(a,e)=>{const t=u("v-form-render"),l=u("el-empty"),i=u("el-button"),o=u("ml-dialog"),s=v("loading");return f(q)?(y(),j(o,{key:0,title:f(z).dialogTitle,modelValue:f(q),"onUpdate:modelValue":e[1]||(e[1]=a=>b(q)?q.value=a:q=a),width:"55%"},{footer:c((()=>[N(i,{onClick:e[0]||(e[0]=a=>b(q)?q.value=!1:q=!1)},{default:c((()=>[g("取消")])),_:1}),!f(z).detailId||1!=f(z).approvalStatus.value&&3!=f(z).approvalStatus.value?(y(),j(i,{key:0,type:"primary",onClick:O},{default:c((()=>[g("确认")])),_:1})):I("",!0)])),default:c((()=>[U((y(),w("div",h,[f(z).detailId&&3==f(z).approvalStatus.value?(y(),w("div",k,"记录已完成审批，禁止编辑")):I("",!0),f(z).detailId&&1==f(z).approvalStatus.value?(y(),w("div",x,"记录正在审批中，禁止编辑")):I("",!0),f(B)?(y(),j(t,{key:2,ref_key:"vFormRef",ref:R,"global-dsv":J.value,"option-data":f(V)},null,8,["global-dsv","option-data"])):(y(),j(l,{key:3,"image-size":100,description:"未查询到相关配置数据"}))])),[[s,f(E)]])])),_:1},8,["title","modelValue"])):I("",!0)}}},[["__scopeId","data-v-67e7e422"]]);export{D as default};
