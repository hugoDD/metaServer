import{l as e,o as l,a as o,g as a,c as d,w as t,r as n,R as i,v as s,u,p as r,Y as c,E as m,f as p,t as v,a0 as f,z as y,i as V,ag as b,G as h,F as g,A as k,X as _,n as N,bh as C,bf as w,C as j,e as U}from"./@vue-1ad4818c.js";import{_ as R,f as x,v as L}from"./index-ea085229.js";import{m as T}from"./index-e05612d6.js";import{d as q,s as O}from"./pinia-3f60a8e1.js";import{u as S}from"./vue-router-414ebc36.js";import{a as z}from"./element-plus-bab58d46.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./@babel-6bd44fd1.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./nprogress-c04e6182.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./@element-plus-2a6d398c.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./@vueuse-477b4dbb.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./lodash-es-b8e8104a.js";import"./@ant-design-60f2ef8e.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";import"./@popperjs-b78c3215.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";const A={props:{modelValue:{type:Object,default:()=>{}}},data:()=>({}),mounted(){},methods:{addType(e){var l={};1==e?l={nodeName:"审批人",type:1,nodeRoleType:2,nodeRoleList:[],userSelectFlag:!0,transferApproval:!0,addSignaturesApproval:!0,multiPersonApproval:1,modifiableFields:[],childNode:this.modelValue}:2==e?l={nodeName:"抄送人",type:2,userSelectFlag:!0,automaticSharing:!1,nodeUserList:[],externalUserList:[],childNode:this.modelValue}:4==e&&(l={nodeName:"条件路由",type:4,conditionNodes:[{nodeName:"条件1",type:3,conditionMode:1,conditionList:[],conditionExpression:"",priorityLevel:1,filter:{equation:"",items:[]}},{nodeName:"条件2",type:3,conditionMode:1,conditionList:[],conditionExpression:"",priorityLevel:2,filter:{equation:"",items:[]}}],childNode:this.modelValue}),this.$emit("update:modelValue",l)}}},$={class:"add-node-btn-box"},E={class:"add-node-btn"},F={class:"add-node-popover-body"},I=a("p",null,"审批节点",-1),D=a("p",null,"抄送节点",-1),K=a("p",null,"条件分支",-1);const M=R(A,[["render",function(n,i,s,u,r,c){const m=e("el-button"),p=e("el-icon-user-filled"),v=e("el-icon"),f=e("el-icon-promotion"),y=e("el-icon-share"),V=e("el-popover");return l(),o("div",$,[a("div",E,[d(V,{placement:"right-start",width:270,trigger:"click","hide-after":0,"show-after":0},{reference:t((()=>[d(m,{type:"primary",icon:"el-icon-plus",circle:""})])),default:t((()=>[a("div",F,[a("ul",null,[a("li",null,[d(v,{style:{color:"#ff943e"},onClick:i[0]||(i[0]=e=>c.addType(1))},{default:t((()=>[d(p)])),_:1}),I]),a("li",null,[d(v,{style:{color:"#3296fa"},onClick:i[1]||(i[1]=e=>c.addType(2))},{default:t((()=>[d(f)])),_:1}),D]),a("li",null,[d(v,{style:{color:"#15BC83"},onClick:i[2]||(i[2]=e=>c.addType(4))},{default:t((()=>[d(y)])),_:1}),K])])])])),_:1})])])}]]),P=q("approvalProcessStore",(()=>({style:n("default")})),{persist:!0}),B=e=>(C("data-v-8da6dcdd"),e=e(),w(),e),G={class:"node-wrap"},H={class:"title reviewed"},J={key:0,class:"we-com-hr"},X={class:"content reviewed"},Y={class:"default-div"},Q={key:0},W={key:1,class:"placeholder"},Z={class:"node-wrap-drawer__title"},ee={class:"work-flow-conditions mb-20"},le=B((()=>a("div",{class:"lable-title mb-3"},"由谁审批",-1))),oe={class:"mt-10"},ae={style:{width:"calc(100% - 200px)",display:"inline-block","margin-left":"10px"}},de={class:"mt-10"},te=B((()=>a("div",{class:"lable-title mb-10 mt-20"},"当有多人审批时",-1))),ne={class:"mt-10"},ie=B((()=>a("div",{class:"lable-title mb-10 mt-20"},"允许修改字段",-1))),se={class:"edit-field-list-box"},ue=["onClick"],re=["title"],ce={class:"add-field-div mt-10"},me={style:{flex:"auto"}},pe=R({__name:"approver",props:{modelValue:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(C,{emit:w}){const j=C,U=S();let R=i("$ElMessage"),L=i("$API");const{style:q}=O(P()),{allEntityName:z}=O(x());let A=n({}),$=n(!1),E=s({}),F=n(!1),I=n(),D=n(),K=n(""),B=n([{label:"指定审批人",type:3},{label:"指定部门负责人",type:4},{label:"发起人自己",type:2},{label:"发起人部门负责人",type:5},{label:"数据所属部门负责人",type:6}]),pe=n([{label:"当前部门",value:0},{label:"二级部门",value:1},{label:"三级部门",value:2},{label:"四级部门",value:3},{label:"五级部门",value:4},{label:"六级部门",value:5},{label:"七级部门",value:6},{label:"八级部门",value:7},{label:"九级部门",value:8},{label:"十级部门",value:9}]);u((()=>j.modelValue),(()=>{A.value=j.modelValue}),{deep:!0});let ve=n([]),fe=n(!1);r((()=>{A.value=j.modelValue;let e=U.currentRoute.value.query.entityCode;e&&(K.value=z.value[e]),ye()}));const ye=async()=>{fe.value=!0;let e=await L.common.getDepartment();if(e&&e.data){let l=e.data||[];ve.value=l.map((e=>({name:`${e.departmentName}(${e.departmentOwnerUser?e.departmentOwnerUser.name:"未设置负责人"})`,id:e.departmentId})))}fe.value=!1},Ve=()=>{E=Object.assign(E,A.value),$.value=!1,F.value=!0},be=async()=>{$.value=!0,await N(),D.value.focus()},he=()=>{$.value=!1},ge=()=>{let{nodeRoleType:e,nodeRoleList:l}=E;3==e&&l.length<1?R.error("请选择指定审批人"):4==e&&l.length<1?R.error("请选择指定部门负责人"):(w("update:modelValue",E),F.value=!1)},ke=()=>{E.nodeRoleList=[]},_e=e=>2==e.nodeRoleType?"发起人自己":5==e.nodeRoleType?"发起人部门负责人":6==e.nodeRoleType?"数据所属部分负责人":e.nodeRoleList&&e.nodeRoleList.length>0?e.nodeRoleList.map((e=>e.name)).join("、"):void 0,Ne=()=>{I.value.openDialg()};return(n,i)=>{const s=e("el-icon-user-filled"),u=e("el-icon"),r=e("el-icon-close"),N=e("el-icon-edit"),C=e("el-input"),j=e("el-option"),U=e("el-select"),R=e("mlSelectUser"),x=e("el-checkbox"),L=e("el-radio"),O=e("el-radio-group"),S=e("ElIconClose"),z=e("el-button"),P=e("el-drawer"),ye=c("loading");return l(),o("div",G,[a("div",{class:"node-wrap-box",onClick:Ve},[a("div",H,["weCom"===m(q)?(l(),o("div",J)):p("",!0),d(u,{class:"icon"},{default:t((()=>[d(s)])),_:1}),a("span",null,v(m(A).nodeName),1),d(u,{class:"close",onClick:i[0]||(i[0]=f((e=>{w("update:modelValue",A.value.childNode)}),["stop"]))},{default:t((()=>[d(r)])),_:1})]),a("div",X,[a("div",Y,[_e(m(A))?(l(),o("span",Q,v(_e(m(A))),1)):(l(),o("span",W,"请选择"))])])]),d(M,{modelValue:m(A).childNode,"onUpdate:modelValue":i[1]||(i[1]=e=>m(A).childNode=e)},null,8,["modelValue"]),d(P,{class:"mlnode-drawer",title:"审批人设置",modelValue:m(F),"onUpdate:modelValue":i[13]||(i[13]=e=>h(F)?F.value=e:F=e),"destroy-on-close":"","append-to-body":"",size:500},{header:t((()=>[a("div",Z,[m($)?p("",!0):(l(),o("label",{key:0,onClick:be},[y(v(m(E).nodeName)+" ",1),d(u,{class:"node-wrap-drawer__title-edit"},{default:t((()=>[d(N)])),_:1})])),m($)?(l(),V(C,{key:1,ref_key:"nodeTitle",ref:D,modelValue:m(E).nodeName,"onUpdate:modelValue":i[2]||(i[2]=e=>m(E).nodeName=e),clearable:"",onBlur:he,onKeyup:b(he,["enter"])},null,8,["modelValue","onKeyup"])):p("",!0)])])),footer:t((()=>[a("div",me,[d(z,{onClick:i[11]||(i[11]=e=>h(F)?F.value=!1:F=!1)},{default:t((()=>[y("取消")])),_:1}),d(z,{type:"primary",onClick:ge},{default:t((()=>[y("保存")])),_:1})])])),default:t((()=>[a("div",ee,[le,a("div",oe,[d(U,{modelValue:m(E).nodeRoleType,"onUpdate:modelValue":i[3]||(i[3]=e=>m(E).nodeRoleType=e),placeholder:"选择由谁审批",style:{width:"180px"},onChange:ke},{default:t((()=>[(l(!0),o(g,null,k(m(B),(e=>(l(),V(j,{key:e.type,label:e.label,value:e.type},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),a("div",ae,[3==m(E).nodeRoleType?(l(),V(R,{key:0,modelValue:m(E).nodeRoleList,"onUpdate:modelValue":i[4]||(i[4]=e=>m(E).nodeRoleList=e),multiple:"",clearable:""},null,8,["modelValue"])):p("",!0),4==m(E).nodeRoleType?_((l(),V(U,{key:1,modelValue:m(E).nodeRoleList,"onUpdate:modelValue":i[5]||(i[5]=e=>m(E).nodeRoleList=e),clearable:"",multiple:"","value-key":"name",placeholder:"请选择指定部门负责人"},{default:t((()=>[(l(!0),o(g,null,k(m(ve),((e,o)=>(l(),V(j,{key:o,disabled:-1!=e.name.indexOf("未设置负责人"),label:e.name,value:e},null,8,["disabled","label","value"])))),128))])),_:1},8,["modelValue"])),[[ye,m(fe)]]):p("",!0),5==m(E).nodeRoleType||6==m(E).nodeRoleType?(l(),V(U,{key:2,modelValue:m(E).deptLevel,"onUpdate:modelValue":i[6]||(i[6]=e=>m(E).deptLevel=e),placeholder:"请选择指定部门负责人"},{default:t((()=>[(l(!0),o(g,null,k(m(pe),((e,o)=>(l(),V(j,{key:o,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):p("",!0)])]),a("div",de,[d(x,{modelValue:m(E).userSelectFlag,"onUpdate:modelValue":i[7]||(i[7]=e=>m(E).userSelectFlag=e),label:"同时允许自选"},null,8,["modelValue"])]),a("div",null,[d(x,{modelValue:m(E).transferApproval,"onUpdate:modelValue":i[8]||(i[8]=e=>m(E).transferApproval=e),label:"允许审批人转审"},null,8,["modelValue"])]),a("div",null,[d(x,{modelValue:m(E).addSignaturesApproval,"onUpdate:modelValue":i[9]||(i[9]=e=>m(E).addSignaturesApproval=e),label:"允许审批人加签"},null,8,["modelValue"])]),te,a("div",ne,[d(O,{class:"radio-need-block",modelValue:m(E).multiPersonApproval,"onUpdate:modelValue":i[10]||(i[10]=e=>m(E).multiPersonApproval=e)},{default:t((()=>[d(L,{label:1},{default:t((()=>[y("会签 (需所有审批人同意)")])),_:1}),d(L,{label:2},{default:t((()=>[y("或签 (一名审批人同意或拒绝)")])),_:1})])),_:1},8,["modelValue"])]),ie,a("div",se,[(l(!0),o(g,null,k(m(E).modifiableFields,((e,n)=>(l(),o("div",{class:"edit-field-list",key:n},[y(v(e.label)+" ",1),a("span",{class:"fr del-icon",onClick:e=>{return l=n,void E.modifiableFields.splice(l,1);var l}},[d(u,{size:"16"},{default:t((()=>[d(S)])),_:1})],8,ue),a("span",{class:"required-icon fr",title:e.reserved?"系统字段无法修改":""},[d(x,{onChange:l=>(e=>{!e.isEdit&&e.isRequired&&(e.isEdit=!0)})(e),disabled:e.reserved,modelValue:e.isRequired,"onUpdate:modelValue":l=>e.isRequired=l,label:"必填"},null,8,["onChange","disabled","modelValue","onUpdate:modelValue"])],8,re)])))),128))]),a("div",ce,[d(z,{icon:"el-icon-plus",onClick:Ne},{default:t((()=>[y("选择字段")])),_:1})])]),d(T,{ref_key:"SelectFieldDialog",ref:I,modelValue:m(E).modifiableFields,"onUpdate:modelValue":i[12]||(i[12]=e=>m(E).modifiableFields=e),title:"选择可修改字段",entityName:m(K)},null,8,["modelValue","entityName"])])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-8da6dcdd"]]),ve={class:"node-wrap"},fe={class:"title promoter"},ye={key:0,class:"we-com-hr"},Ve={class:"content promoter"},be={class:"default-div"},he={class:"node-wrap-drawer__title"},ge={class:"work-flow-conditions mb-20"},ke=a("div",{class:"lable-title mb-3"},"谁可以发起此审批",-1),_e={class:"mb-10 mt-10"},Ne=a("div",{class:"lable-title mb-10 mt-20"},"发起条件",-1),Ce=a("div",{class:"info-text"},"符合条件的记录才可以使用/选择此流程",-1),we={style:{flex:"auto"}},je={key:0},Ue={__name:"promoter",props:{modelValue:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(c,{emit:f}){const g=c,k=S();let _=i("$ElMessage"),C=i("$CloneDeep");const{style:w}=O(P());let j=n({}),U=n(!1),R=n(!1),x=s({}),L=n(!1),T=s({});const q=n();let z=n("");u((()=>g.modelValue),(()=>{j.value=g.modelValue}),{deep:!0}),r((()=>{var e;j.value=g.modelValue,z.value=null==(e=k.currentRoute.value.query)?void 0:e.entityCode}));const A=()=>{x=Object.assign(x,j.value),R.value=!1,U.value=!0},$=async()=>{R.value=!0,await N(),q.value.focus()},E=()=>{R.value=!1},F=()=>{3!==x.nodeRoleType&&(x.nodeRoleList=[])},I=()=>{let{filter:e}=x,l=e.items.length;return l>0?`已设置条件（${l}）`:"点击设置"},D=()=>{let{filter:e}=C(x);e=K(e),T=e,L.value=!0},K=e=>{let{equation:l}=e;return l&&"OR"!==l?"AND"===l?(e.type=2,e.equation="AND"):e.type=3:(e.type=1,e.equation="OR"),e},B=e=>{Object.assign(x.filter,e),f("update:modelValue",x),L.value=!1},G=()=>{let{nodeRoleType:e,nodeRoleList:l}=x;3==e&&l.length<1?_.error("请选择用户"):(f("update:modelValue",x),U.value=!1)};return(n,i)=>{const s=e("el-icon-user-filled"),u=e("el-icon"),r=e("el-icon-edit"),c=e("el-input"),f=e("el-radio"),g=e("el-radio-group"),k=e("mlSelectUser"),_=e("el-button"),N=e("el-drawer"),C=e("mlSetConditions"),O=e("mlDialog");return l(),o("div",ve,[a("div",{class:"node-wrap-box start-node",onClick:A},[a("div",fe,["weCom"===m(w)?(l(),o("div",ye)):p("",!0),d(u,{class:"icon"},{default:t((()=>[d(s)])),_:1}),a("span",null,v(m(j).nodeName),1)]),a("div",Ve,[a("div",be,v((S=m(j),2==S.nodeRoleType?"记录所属用户":3!=S.nodeRoleType?"所有人":S.nodeRoleList&&S.nodeRoleList.length>0?S.nodeRoleList.map((e=>e.name)).join("、"):void 0)),1)])]),d(M,{modelValue:m(j).childNode,"onUpdate:modelValue":i[0]||(i[0]=e=>m(j).childNode=e)},null,8,["modelValue"]),d(N,{class:"mlnode-drawer",title:"发起人",modelValue:m(U),"onUpdate:modelValue":i[5]||(i[5]=e=>h(U)?U.value=e:U=e),"destroy-on-close":"","append-to-body":"",size:500},{header:t((()=>[a("div",he,[m(R)?p("",!0):(l(),o("label",{key:0,onClick:$},[y(v(m(x).nodeName)+" ",1),d(u,{class:"node-wrap-drawer__title-edit"},{default:t((()=>[d(r)])),_:1})])),m(R)?(l(),V(c,{key:1,ref_key:"nodeTitle",ref:q,modelValue:m(x).nodeName,"onUpdate:modelValue":i[1]||(i[1]=e=>m(x).nodeName=e),clearable:"",onBlur:E,onKeyup:b(E,["enter"])},null,8,["modelValue","onKeyup"])):p("",!0)])])),footer:t((()=>[a("div",we,[d(_,{onClick:i[4]||(i[4]=e=>h(U)?U.value=!1:U=!1)},{default:t((()=>[y("取消")])),_:1}),d(_,{type:"primary",onClick:G},{default:t((()=>[y("保存")])),_:1})])])),default:t((()=>[a("div",ge,[ke,a("div",_e,[d(g,{class:"radio-need-block",modelValue:m(x).nodeRoleType,"onUpdate:modelValue":i[2]||(i[2]=e=>m(x).nodeRoleType=e),onChange:F},{default:t((()=>[d(f,{label:1},{default:t((()=>[y("所有人")])),_:1}),d(f,{label:2},{default:t((()=>[y("记录所属用户")])),_:1}),d(f,{label:3},{default:t((()=>[y("指定用户")])),_:1})])),_:1},8,["modelValue"])]),3==m(x).nodeRoleType?(l(),V(k,{key:0,modelValue:m(x).nodeRoleList,"onUpdate:modelValue":i[3]||(i[3]=e=>m(x).nodeRoleList=e),multiple:"",clearable:""},null,8,["modelValue"])):p("",!0),Ne,a("div",{class:"ml-a-span mb-3",onClick:D},v(I()),1),Ce])])),_:1},8,["modelValue"]),m(L)?(l(),o("div",je,[d(O,{title:"发起条件","append-to-body":"",width:"37%",modelValue:m(L),"onUpdate:modelValue":i[8]||(i[8]=e=>h(L)?L.value=e:L=e)},{default:t((()=>[d(C,{modelValue:m(T),"onUpdate:modelValue":i[6]||(i[6]=e=>h(T)?T.value=e:T=e),footer:"",onCancel:i[7]||(i[7]=e=>h(L)?L.value=!1:L=!1),onConfirm:B,entityName:m(z)},null,8,["modelValue","entityName"])])),_:1},8,["modelValue"])])):p("",!0)]);var S}}},Re={class:"branch-wrap"},xe={class:"branch-box-wrap"},Le={class:"branch-box"},Te={class:"condition-node"},qe={class:"condition-node-box"},Oe=["onClick"],Se=["onClick"],ze={class:"title branch"},Ae={key:0,class:"we-com-hr"},$e={class:"node-title"},Ee={class:"priority-title"},Fe={class:"content branch"},Ie={class:"default-div"},De=["onClick"],Ke={key:1,class:"top-left-cover-line"},Me={key:2,class:"bottom-left-cover-line"},Pe={key:3,class:"top-right-cover-line"},Be={key:4,class:"bottom-right-cover-line"},Ge={class:"node-wrap-drawer__title"},He={key:0,class:"last-nodes"},Je={style:{flex:"auto"}},Xe=R({__name:"branch",props:{modelValue:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(c,{emit:_}){const C=c,w=S();i("$ElMessage");const{style:R}=O(P());let x=n({}),T=n(!1),q=n(!1),z=n(0),A=n({}),$=s({}),E=n(),F=n(!1),I=n("");u((()=>C.modelValue),(()=>{x.value=C.modelValue}),{deep:!0}),r((()=>{var e;x.value=C.modelValue,I.value=null==(e=w.currentRoute.value.query)?void 0:e.entityCode}));const D=e=>{let{equation:l}=e;return l&&"OR"!==l?"AND"===l?(e.type=2,e.equation="AND"):e.type=3:(e.type=1,e.equation="OR"),e};let K=n("");const B=async()=>{q.value=!0,await N(),K.value.focus()},G=()=>{q.value=!1},H=()=>{E.value.checkConditionList()&&(x.value.conditionNodes[z.value]=A.value,_("update:modelValue",x.value),T.value=!1)},J=()=>{let e=x.value.conditionNodes.length+1;x.value.conditionNodes.push({nodeName:"条件"+e,type:3,priorityLevel:e,conditionMode:1,conditionList:[],conditionExpression:"",filter:{equation:"",items:[]}})},X=(e,l)=>{e.childNode?X(e.childNode,l):e.childNode=l},Y=(e,l=1)=>{x.value.conditionNodes[e]=x.value.conditionNodes.splice(e+l,1,x.value.conditionNodes[e])[0],x.value.conditionNodes.map(((e,l)=>{e.priorityLevel=l+1})),_("update:modelValue",x.value)},Q=(e,l)=>{var{filter:o}=e.conditionNodes[l];return l===e.conditionNodes.length-1?o&&o.items&&o.items.length>0?`其他条件（${o.items.length}）`:"其他条件":o&&o.items&&o.items.length>0?`已设置条件（${o.items.length}）`:"请设置条件"};return(n,i)=>{const s=e("el-button"),u=e("el-icon-arrow-left"),r=e("el-icon"),c=e("el-icon-close"),N=e("el-icon-arrow-right"),C=e("el-icon-edit"),w=e("el-input"),O=e("el-drawer");return l(),o("div",Re,[a("div",xe,[a("div",Le,[d(s,{class:"add-branch",type:"success",plain:"",round:"",onClick:J},{default:t((()=>[y("添加条件")])),_:1}),(l(!0),o(g,null,k(m(x).conditionNodes,((e,i)=>(l(),o("div",{class:"col-box",key:i},[a("div",Te,[a("div",qe,[a("div",{class:"auto-judge",onClick:e=>(e=>{z.value=e,A.value=x.value.conditionNodes[e],F.value=!1,e===x.value.conditionNodes.length-1&&(F.value=!0);let{filter:l}=A.value;l=D(l),$=l,T.value=!0})(i)},[0!=i?(l(),o("div",{key:0,class:"sort-left",onClick:f((e=>Y(i,-1)),["stop"])},[d(r,null,{default:t((()=>[d(u)])),_:1})],8,Se)):p("",!0),a("div",ze,["weCom"===m(R)?(l(),o("div",Ae)):p("",!0),a("span",$e,v(e.nodeName),1),a("span",Ee,"优先级"+v(i+1),1),d(r,{class:"close",onClick:f((e=>(e=>{x.value.conditionNodes.splice(e,1),1==x.value.conditionNodes.length&&(x.value.childNode&&(x.value.conditionNodes[0].childNode?X(x.value.conditionNodes[0].childNode,x.value.childNode):x.value.conditionNodes[0].childNode=x.value.childNode),_("update:modelValue",x.value.conditionNodes[0].childNode))})(i)),["stop"])},{default:t((()=>[d(c)])),_:2},1032,["onClick"])]),a("div",Fe,[a("div",Ie,[a("span",null,v(Q(m(x),i)),1)])]),i!=m(x).conditionNodes.length-1?(l(),o("div",{key:1,class:"sort-right",onClick:f((e=>Y(i)),["stop"])},[d(r,null,{default:t((()=>[d(N)])),_:1})],8,De)):p("",!0)],8,Oe),d(M,{modelValue:e.childNode,"onUpdate:modelValue":l=>e.childNode=l},null,8,["modelValue","onUpdate:modelValue"])])]),e.childNode?j(n.$slots,"default",{key:0,node:e},void 0,!0):p("",!0),0==i?(l(),o("div",Ke)):p("",!0),0==i?(l(),o("div",Me)):p("",!0),i==m(x).conditionNodes.length-1?(l(),o("div",Pe)):p("",!0),i==m(x).conditionNodes.length-1?(l(),o("div",Be)):p("",!0)])))),128))]),d(M,{modelValue:m(x).childNode,"onUpdate:modelValue":i[0]||(i[0]=e=>m(x).childNode=e)},null,8,["modelValue"])]),d(O,{title:"条件设置",modelValue:m(T),"onUpdate:modelValue":i[4]||(i[4]=e=>h(T)?T.value=e:T=e),"destroy-on-close":"","append-to-body":"",size:600,class:"mlnode-drawer"},{header:t((()=>[a("div",Ge,[m(q)?p("",!0):(l(),o("label",{key:0,onClick:B},[y(v(m(A).nodeName)+" ",1),d(r,{class:"node-wrap-drawer__title-edit"},{default:t((()=>[d(C)])),_:1})])),m(q)?(l(),V(w,{key:1,ref_key:"nodeTitle",ref:K,modelValue:m(A).nodeName,"onUpdate:modelValue":i[1]||(i[1]=e=>m(A).nodeName=e),clearable:"",onBlur:G,onKeyup:b(G,["enter"])},null,8,["modelValue","onKeyup"])):p("",!0)])])),footer:t((()=>[a("div",Je,[d(s,{onClick:i[3]||(i[3]=e=>h(T)?T.value=!1:T=!1)},{default:t((()=>[y("取消")])),_:1}),d(s,{type:"primary",onClick:H},{default:t((()=>[y("保存")])),_:1})])])),default:t((()=>[m(F)?(l(),o("div",He,"该分支将作为最终分支匹配其他条件")):p("",!0),a("div",{class:U(["work-flow-conditions mb-20",{"mt-30":m(F)}])},[d(L,{ref_key:"mlSetConditionsRef",ref:E,modelValue:m($),"onUpdate:modelValue":i[2]||(i[2]=e=>h($)?$.value=e:$=e),entityName:m(I)},null,8,["modelValue","entityName"])],2)])),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-75aa9720"]]),Ye={class:"node-wrap"},Qe={class:"title ccto"},We={key:0,class:"we-com-hr"},Ze={class:"content ccto"},el={class:"default-div"},ll={key:0},ol={key:1,class:"placeholder"},al={class:"node-wrap-drawer__title"},dl={class:"work-flow-conditions mb-20"},tl=a("div",{class:"lable-title mb-3"},"审批结果抄送给谁",-1),nl=a("div",{class:"lable-title mb-3 mt-20"},"抄送给外部人员",-1),il=a("div",{class:"info-text"},"选择外部人员的电话 (手机) 或邮箱字段",-1),sl={style:{flex:"auto"}},ul={__name:"send",props:{modelValue:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(i,{emit:c}){const g=i,{style:k}=O(P());let _=n({}),C=n(!1),w=s({}),j=n(!1),U=n();u((()=>g.modelValue),(()=>{_.value=g.modelValue}),{deep:!0}),r((()=>{_.value=g.modelValue}));const R=()=>{w=Object.assign(w,_.value),j.value=!0},x=async()=>{C.value=!0,await N(),U.value.focus()},L=()=>{C.value=!1},T=()=>{c("update:modelValue",w),j.value=!1},q=e=>{if(e.nodeUserList&&e.nodeUserList.length>0){return e.nodeUserList.map((e=>e.name)).join("、")}return!!e.userSelectFlag&&"发起人自选"};return(n,i)=>{const s=e("el-icon-promotion"),u=e("el-icon"),r=e("el-icon-close"),g=e("el-icon-edit"),N=e("el-input"),O=e("mlSelectUser"),S=e("el-checkbox"),z=e("el-button"),A=e("el-drawer");return l(),o("div",Ye,[a("div",{class:"node-wrap-box",onClick:R},[a("div",Qe,["weCom"===m(k)?(l(),o("div",We)):p("",!0),d(u,{class:"icon"},{default:t((()=>[d(s)])),_:1}),a("span",null,v(m(_).nodeName),1),d(u,{class:"close",onClick:i[0]||(i[0]=f((e=>{c("update:modelValue",_.value.childNode)}),["stop"]))},{default:t((()=>[d(r)])),_:1})]),a("div",Ze,[a("div",el,[q(m(_))?(l(),o("span",ll,v(q(m(_))),1)):(l(),o("span",ol,"请选择人员"))])])]),d(M,{modelValue:m(_).childNode,"onUpdate:modelValue":i[1]||(i[1]=e=>m(_).childNode=e)},null,8,["modelValue"]),d(A,{title:"抄送人设置",modelValue:m(j),"onUpdate:modelValue":i[8]||(i[8]=e=>h(j)?j.value=e:j=e),"destroy-on-close":"","append-to-body":"",size:500,class:"mlnode-drawer"},{header:t((()=>[a("div",al,[m(C)?p("",!0):(l(),o("label",{key:0,onClick:x},[y(v(m(w).nodeName)+" ",1),d(u,{class:"node-wrap-drawer__title-edit"},{default:t((()=>[d(g)])),_:1})])),m(C)?(l(),V(N,{key:1,ref_key:"nodeTitle",ref:U,modelValue:m(w).nodeName,"onUpdate:modelValue":i[2]||(i[2]=e=>m(w).nodeName=e),clearable:"",onBlur:L,onKeyup:b(L,["enter"])},null,8,["modelValue","onKeyup"])):p("",!0)])])),footer:t((()=>[a("div",sl,[d(z,{onClick:i[7]||(i[7]=e=>h(j)?j.value=!1:j=!1)},{default:t((()=>[y("取消")])),_:1}),d(z,{type:"primary",onClick:T},{default:t((()=>[y("保存")])),_:1})])])),default:t((()=>[a("div",dl,[tl,d(O,{class:"mt-5 mb-5",modelValue:m(w).nodeUserList,"onUpdate:modelValue":i[3]||(i[3]=e=>m(w).nodeUserList=e),multiple:"",clearable:""},null,8,["modelValue"]),a("div",null,[d(S,{modelValue:m(w).userSelectFlag,"onUpdate:modelValue":i[4]||(i[4]=e=>m(w).userSelectFlag=e),label:"同时允许自选"},null,8,["modelValue"])]),a("div",null,[d(S,{modelValue:m(w).automaticSharing,"onUpdate:modelValue":i[5]||(i[5]=e=>m(w).automaticSharing=e),label:"抄送人无读取权限时自动共享"},null,8,["modelValue"])]),nl,d(O,{class:"mt-5 mb-5",modelValue:m(w).externalUserList,"onUpdate:modelValue":i[6]||(i[6]=e=>m(w).externalUserList=e),multiple:"",clearable:""},null,8,["modelValue"]),il])])),_:1},8,["modelValue"])])}}};const rl=R({props:{modelValue:{type:Object,default:()=>{}}},components:{approver:pe,promoter:Ue,branch:Xe,send:ul},data:()=>({nodeConfig:{}}),watch:{modelValue(e){this.nodeConfig=e},nodeConfig(e){this.$emit("update:modelValue",e)}},mounted(){this.nodeConfig=this.modelValue},methods:{}},[["render",function(a,d,n,i,s,u){const r=e("promoter"),c=e("approver"),m=e("send"),v=e("node-wrap",!0),f=e("branch");return l(),o(g,null,[0==s.nodeConfig.type?(l(),V(r,{key:0,modelValue:s.nodeConfig,"onUpdate:modelValue":d[0]||(d[0]=e=>s.nodeConfig=e)},null,8,["modelValue"])):p("",!0),1==s.nodeConfig.type?(l(),V(c,{key:1,modelValue:s.nodeConfig,"onUpdate:modelValue":d[1]||(d[1]=e=>s.nodeConfig=e)},null,8,["modelValue"])):p("",!0),2==s.nodeConfig.type?(l(),V(m,{key:2,modelValue:s.nodeConfig,"onUpdate:modelValue":d[2]||(d[2]=e=>s.nodeConfig=e)},null,8,["modelValue"])):p("",!0),4==s.nodeConfig.type?(l(),V(f,{key:3,modelValue:s.nodeConfig,"onUpdate:modelValue":d[3]||(d[3]=e=>s.nodeConfig=e)},{default:t((e=>[e.node?(l(),V(v,{key:0,modelValue:e.node.childNode,"onUpdate:modelValue":l=>e.node.childNode=l},null,8,["modelValue","onUpdate:modelValue"])):p("",!0)])),_:1},8,["modelValue"])):p("",!0),s.nodeConfig.childNode?(l(),V(v,{key:4,modelValue:s.nodeConfig.childNode,"onUpdate:modelValue":d[4]||(d[4]=e=>s.nodeConfig.childNode=e)},null,8,["modelValue"])):p("",!0)],64)}]]),cl={class:"edit-zoom"},ml={class:"span-zoom ml-5 mr-5"},pl={class:"pt-10"},vl={class:"box-scale"},fl=a("div",{class:"end-node"},[a("div",{class:"end-node-circle"}),a("div",{class:"end-node-text"},"流程结束")],-1),yl={key:1,class:"z-model"},Vl={__name:"index",props:{modelValue:{type:Object,default:()=>{}}},emits:["update:modelValue"],setup(i,{emit:s}){const c=i,f=S(),{style:y}=O(P());let b=n(null),g=n(100),k=n(200),_=n(10),N=n(10),C=n(!1),w=n(!1);u((()=>c.modelValue),(e=>{b.value=e}),{deep:!0}),u(b,(e=>{s("update:modelValue",e)}),{deep:!0}),r((()=>{1==f.currentRoute.value.query.look&&(w.value=!0)}));const j=e=>{if("inc"===e){if(g.value===k.value)return;g.value+=N.value}else{if(g.value===_.value)return;g.value-=N.value}document.querySelectorAll(".box-scale")[0].style.zoom=g.value+"%"};return(n,i)=>{const s=e("ElIconPlus"),u=e("el-icon"),r=e("el-button"),c=e("ElIconMinus"),f=e("ElIconSetting"),k=e("el-option"),_=e("el-select"),N=e("el-form-item"),R=e("el-form"),x=e("el-popover");return l(),o("div",{class:U(["sc-workflow-design",{"is-default":"default"===m(y),"is-wecom":"weCom"===m(y)}])},[a("div",cl,[d(r,{size:"small",style:{width:"24px"},onClick:i[0]||(i[0]=e=>j("inc"))},{default:t((()=>[d(u,null,{default:t((()=>[d(s)])),_:1})])),_:1}),a("span",ml,v(m(g))+"%",1),d(r,{size:"small",style:{width:"24px"},onClick:i[1]||(i[1]=e=>j("dec"))},{default:t((()=>[d(u,null,{default:t((()=>[d(c)])),_:1})])),_:1}),d(x,{placement:"bottom",width:200,visible:m(C)},{reference:t((()=>[d(r,{size:"small",style:{width:"24px"},onClick:i[2]||(i[2]=e=>h(C)?C.value=!m(C):C=!m(C))},{default:t((()=>[d(u,null,{default:t((()=>[d(f)])),_:1})])),_:1})])),default:t((()=>[a("div",pl,[d(R,{"label-position":"top","label-width":"100px"},{default:t((()=>[d(N,{label:"切换风格"},{default:t((()=>[d(_,{modelValue:m(y),"onUpdate:modelValue":i[3]||(i[3]=e=>h(y)?y.value=e:null)},{default:t((()=>[d(k,{label:"默认",value:"default"}),d(k,{label:"仿钉钉",value:"dingding"}),d(k,{label:"仿企业微信",value:"weCom"})])),_:1},8,["modelValue"])])),_:1})])),_:1})])])),_:1},8,["visible"])]),a("div",vl,[m(b)?(l(),V(rl,{key:0,modelValue:m(b),"onUpdate:modelValue":i[4]||(i[4]=e=>h(b)?b.value=e:b=e)},null,8,["modelValue"])):p("",!0),fl,!n.$TOOL.checkRole("r6016")||m(w)?(l(),o("div",yl)):p("",!0)])],2)}}},bl=R({__name:"process-detail",setup(o){const a=i("$API"),s=i("$TOOL"),u=S();let p=n(!1),f=n(!1),b=n(""),h=n({approvalConfigId:"0000030-b105364997e64227b6f567bbd900a78b",flowName:"请假审批"});r((()=>{b.value=u.currentRoute.value.query.approvalConfigId,1==u.currentRoute.value.query.look&&(p.value=!0),g()}));const g=async()=>{f.value=!0;let e=await a.approval.detial.get({approvalConfigId:b.value});e&&(h.value=Object.assign(h.value,e.data),h.value.nodeConfig||(h.value.nodeConfig={nodeName:"发起人",type:0,nodeRoleType:2,nodeRoleList:[],filter:{equation:"",items:[]}})),f.value=!1},k=async()=>{f.value=!0,await a.approval.detial.save(h.value)&&z.success("保存成功"),f.value=!1};return(o,a)=>{const n=e("el-button"),i=e("el-header"),u=e("el-container"),r=c("loading");return _((l(),V(u,{class:"process-detail"},{default:t((()=>[d(i,{class:"process-title"},{default:t((()=>[y(v(m(h).flowName)+" ",1),d(n,{type:"primary",class:"fr",onClick:k,disabled:!m(s).checkRole("r6016")||m(p)},{default:t((()=>[y("保存")])),_:1},8,["disabled"])])),_:1}),d(u,{class:"main-container"},{default:t((()=>[d(Vl,{modelValue:m(h).nodeConfig,"onUpdate:modelValue":a[0]||(a[0]=e=>m(h).nodeConfig=e)},null,8,["modelValue"])])),_:1})])),_:1})),[[r,m(f)]])}}},[["__scopeId","data-v-a7ecd9e4"]]);export{bl as default};
