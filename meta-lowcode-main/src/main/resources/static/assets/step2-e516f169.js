import{_ as e}from"./index-ea085229.js";import{b as l}from"./element-plus-bab58d46.js";import{R as s,r as a,p as t,l as o,Y as i,X as r,E as p,o as m,a as n,c as u,w as d,g as c,t as j,F as f,A as v,i as w,z as b}from"./@vue-1ad4818c.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./@babel-6bd44fd1.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./@element-plus-2a6d398c.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./@vueuse-477b4dbb.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./lodash-es-b8e8104a.js";import"./@ant-design-60f2ef8e.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";import"./@popperjs-b78c3215.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";const h={class:"step"},g={class:"table-box pl-20"},y={class:"raw-value text-ellipsis"},x={class:"row-inx"},_={class:"row-icon"},V={class:"w-100 mt-20 pl-20"},F=e({__name:"step2",props:{modelValue:null},emits:["update:modelValue","goBack","importSuccess"],setup(e,{emit:F}){const N=e,z=s("$ElMessage"),E=s("$API");let C=a(!1),I=a({}),k=a([]);t((()=>{I.value=N.modelValue,L()}));const A=async()=>{let e=k.value.filter((e=>e.useFileds)),s={};e.forEach((e=>{s[e.useFileds]=e.columnNo})),F("update:modelValue",I.value);let a={...I.value};delete a.columns,delete a.fields,delete a.originalFilename,a.fieldsMapping={...s},a.owningUser=B(I.value.owningUser);let t=I.value.importFields.filter((e=>!e.isNullable));for(let l=0;l<t.length;l++){const e=t[l];if(!a.fieldsMapping.hasOwnProperty(e.fieldName))return void z.warning(e.fieldLabel+"为必填字段，请选择")}l.confirm("请再次确认导入选项和字段映射。开始导入吗？","提示：",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{let e=await await E.upload.begImport(a);C.value=!0,e&&F("importSuccess",e.data),C.value=!1})).catch((()=>{}))},B=e=>e&&e.length>0?e[0].id:null,M=()=>{F("goBack")},L=()=>{let{columns:e,fields:l}=I.value,s=[];e.forEach(((e,l)=>{s.push({rawValue:e.rawValue,rowInx:U(l),fields:I.value.importFields,useFileds:"",columnNo:e.columnNo})})),s.forEach((e=>{l.forEach((l=>{e.rawValue==l.fieldLabel&&(e.useFileds=l.fieldName)}))})),k.value=[...s]},U=e=>{for(var l="A".charCodeAt(0),s="Z".charCodeAt(0)-l+1,a="";e>=0;)a=String.fromCharCode(e%s+l)+a,e=Math.floor(e/s)-1;return a};return(e,l)=>{const s=o("ElIconRight"),a=o("el-icon"),t=o("el-table-column"),F=o("el-option"),N=o("el-select"),z=o("el-table"),E=o("el-button"),I=o("el-form-item"),B=o("el-form"),L=i("loading");return r((m(),n("div",h,[u(B,{"label-width":"120px"},{default:d((()=>[u(I,{label:"设置字段映射"},{default:d((()=>[c("div",g,[u(z,{data:p(k),style:{width:"100%"}},{default:d((()=>[u(t,{label:"数据列",width:"240","show-overflow-tooltip":""},{default:d((e=>[c("div",y,[c("em",x,j(e.row.rowInx),1),c("span",null,j(e.row.rawValue),1),c("span",_,[u(a,{size:"16"},{default:d((()=>[u(s)])),_:1})])])])),_:1}),u(t,{prop:"name",label:"导入到字段"},{default:d((e=>[u(N,{modelValue:e.row.useFileds,"onUpdate:modelValue":l=>e.row.useFileds=l,placeholder:"无",style:{width:"50%"}},{default:d((()=>[(m(!0),n(f,null,v(e.row.fields,((e,l)=>(m(),w(F,{label:e.fieldLabel+(e.isNullable?"":"[必填]"),value:e.fieldName,key:l,filterable:""},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"])]),c("div",V,[u(E,{type:"primary",style:{width:"80px"},onClick:A},{default:d((()=>[b("开始导入")])),_:1}),c("span",{class:"ml-20 ml-a-span",onClick:M},"返回上一步")])])),_:1})])),_:1})])),[[L,p(C)]])}}},[["__scopeId","data-v-42892ddb"]]);export{F as default};
