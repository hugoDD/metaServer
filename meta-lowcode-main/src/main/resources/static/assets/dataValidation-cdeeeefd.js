import{_ as e,n as t}from"./index-ea085229.js";import{C as a}from"./element-plus-bab58d46.js";import{r as o,R as l,p as i,l as s,Y as n,o as r,a as p,X as m,E as u,c as d,w as c,g as v,t as f,z as j,F as C,A as y,G as g,f as b,bh as _,bf as h}from"./@vue-1ad4818c.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./@babel-6bd44fd1.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./@element-plus-2a6d398c.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./@vueuse-477b4dbb.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./lodash-es-b8e8104a.js";import"./@ant-design-60f2ef8e.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";import"./@popperjs-b78c3215.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";const V=e=>(_("data-v-7522ce2a"),e=e(),h(),e),x={class:"action-div"},k=V((()=>v("div",{class:"info-text"},"符合校验条件的数据/记录在操作时会提示失败",-1))),N={class:"input-box"},R=V((()=>v("div",{class:"info-text mt-3"},[j(" 校验未通过时的提示内容。内容支持字段变量，如 "),v("span",{style:{color:"#e83e8c"}},"{createdOn}"),j(" (其中 createdOn 为源实体的字段内部标识) ")],-1))),w=["onClick"],z={key:0},q=e({__name:"dataValidation",props:{modelValue:null},setup(e){const _=e,h=o(),V=o();l("$API"),l("$ElMessage");let q=o(!1),O=o({actionContent:{}});i((()=>{O.value=_.modelValue,O.value.actionContent.filter||(O.value.actionContent.filter={items:[]}),J(),O.value.actionContent.tipContent||(O.value.actionContent.tipContent="")}));const A=()=>{var e,t;null==(t=null==(e=u(V).popperRef)?void 0:e.delayHide)||t.call(e)};let S=o(""),D=o(0);const E=e=>{D.value=e.srcElement.selectionStart},I=(e,t,a)=>e.slice(0,t)+a+e.slice(t);let $=o([]);const J=async()=>{let e=await t(O.value.entityCode,!0,!0);e&&($.value=e.data)};let U=o(!1),B=o({});const G=()=>{let{filter:e}=O.value.actionContent;e=H(e),B.value=JSON.parse(JSON.stringify(e)),U.value=!0},H=e=>{let{equation:t}=e;return t&&"OR"!==t?"AND"===t?(e.type=2,e.equation="AND"):e.type=3:(e.type=1,e.equation="OR"),e},L=()=>{let{filter:e}=O.value.actionContent,t=e&&e.items?e.items.length:0;return t>0?`已设置条件（${t}）`:"点击设置"},M=e=>{O.value.actionContent.filter=e,U.value=!1};return(e,t)=>{const o=s("el-col"),l=s("el-row"),i=s("el-form-item"),_=s("el-input"),J=s("el-popover"),H=s("mlSetConditions"),F=s("mlDialog"),K=n("loading");return r(),p(C,null,[m((r(),p("div",x,[d(i,{class:"mt-20",label:"校验条件"},{default:c((()=>[d(l,null,{default:c((()=>[d(o,{span:24},{default:c((()=>[v("span",{class:"ml-a-span",onClick:G},f(L()),1)])),_:1}),d(o,{span:24},{default:c((()=>[k])),_:1})])),_:1})])),_:1}),d(i,{class:"mt-20",label:"提示内容"},{default:c((()=>[v("div",N,[d(_,{modelValue:u(O).actionContent.tipContent,"onUpdate:modelValue":t[0]||(t[0]=e=>u(O).actionContent.tipContent=e),placeholder:"数据校验未通过",autosize:{minRows:3},type:"textarea",onBlur:E,ref_key:"contentInputRef",ref:S},null,8,["modelValue"]),m((r(),p("span",{ref_key:"buttonRef",ref:h,class:"field-span"},[j("{ }")])),[[u(a),A]])]),d(o,{span:24},{default:c((()=>[R])),_:1})])),_:1})])),[[K,u(q)]]),d(J,{ref_key:"popoverRef",ref:V,"virtual-ref":h.value,trigger:"click",placement:"left","popper-class":"formula-popover","virtual-triggering":""},{default:c((()=>[(r(!0),p(C,null,y(u($),((e,t)=>(r(),p("div",{class:"field-item text-ellipsis",key:t,onClick:t=>(e=>{O.value.actionContent.tipContent=I(O.value.actionContent.tipContent,D.value,`{${e.fieldName}}`);let t=D.value+e.fieldName.length+2;S.value.focus(),setTimeout((()=>{S.value.ref.setSelectionRange(t,t)}),0),V.value.hide()})(e)},f(e.fieldLabel),9,w)))),128))])),_:1},8,["virtual-ref"]),u(U)?(r(),p("div",z,[d(F,{title:"校验条件","append-to-body":"",width:"37%",modelValue:u(U),"onUpdate:modelValue":t[3]||(t[3]=e=>g(U)?U.value=e:U=e)},{default:c((()=>[d(H,{modelValue:u(B),"onUpdate:modelValue":t[1]||(t[1]=e=>g(B)?B.value=e:B=e),footer:"",onCancel:t[2]||(t[2]=e=>g(U)?U.value=!1:U=!1),onConfirm:M,entityName:u(O).entityCode},null,8,["modelValue","entityName"])])),_:1},8,["modelValue"])])):b("",!0)],64)}}},[["__scopeId","data-v-7522ce2a"]]);export{q as default};
