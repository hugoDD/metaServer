import{_ as e,f as l,n as a}from"./index-ea085229.js";import{s as t}from"./pinia-3f60a8e1.js";import{R as s,r as i,p as o,l as r,Y as u,X as p,E as m,o as n,a as d,c as f,w as v,F as c,A as j,i as b,g as y,z as g,t as h,f as w,bh as _,bf as V}from"./@vue-1ad4818c.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";const x=e=>(_("data-v-10f87e43"),e=e(),V(),e),E={class:"step"},F={class:"w-100"},k={key:0,class:"file-name-span"},U=x((()=>y("div",{class:"w-100 mt-5"},[y("ul",{class:"upload-ui"},[y("li",null,"有合并单元格的数据请处理过后再上传，否则可能出现表头识别有误"),y("li",null,"系统默认仅识别第一个 SHEET，且会将首行识别为表头"),y("li",null,[g(" 主实体与明细实体请分别导入，更多帮助请 "),y("a",{class:"ml-a-span",href:"https://www.baidu.com/",target:"_blank"},"参考文档")])])],-1))),z={key:0,class:"sm-title w-100 mt-5"},N={style:{width:"400px"}},O=x((()=>y("div",{class:"w-100 mt-5 info-text"},"不选择则默认为当前用户，如字段映射中指定了用户则以映射为准",-1))),S={class:"w-100 mt-20"},C=e({__name:"step1",props:{modelValue:null},emits:["update:modelValue","fileSuccess"],setup(e,{emit:_}){const V=e,x=s("$ElMessage"),C=s("$API"),{unSystemEntityList:I}=t(l());let q=i({}),A=i(!1),L=i();o((()=>{q.value=V.modelValue,I.value.length>0&&(q.value.mainEntity=I.value[0].name,L.value=I.value[0].entityCode,H())}));const P=()=>{q.value.repeatFields=[];let e=I.value.filter((e=>e.name==q.value.mainEntity));L.value=e[0].entityCode,H(),_("update:modelValue",q.value)},H=async()=>{A.value=!0;let e=await a(L.value,!1,!1,!0);if(e){q.value.fields=e.data||[];let l=[];q.value.importFields=[],q.value.fields.forEach((e=>{e.isNullable||(l.push(e.fieldName),q.value.importFields.push(e))})),q.value.fields.forEach((e=>{l.includes(e.fieldName)||q.value.importFields.push(e)}))}A.value=!1},M=e=>{q.value.filePath=e.fileName,q.value.originalFilename=e.originalFilename,_("update:modelValue",q.value)},$=async()=>{let{filePath:e,repeatOpt:l,repeatFields:a}=q.value;if(!e)return void x.warning("请上传数据文件");if(3!=l&&a.length<1)return void x.warning("请选择充重复判断字段");A.value=!0;let t=await C.upload.checkFile(e);t&&(q.value.columns=t.data,_("update:modelValue",q.value),_("fileSuccess")),A.value=!1};return(e,l)=>{const a=r("el-option"),t=r("el-select"),s=r("el-form-item"),i=r("ElIconUpload"),o=r("el-icon"),_=r("el-button"),V=r("ml-upload"),x=r("el-radio"),C=r("el-radio-group"),L=r("ElIconQuestionFilled"),H=r("el-tooltip"),B=r("mlSelectUser"),D=r("el-form"),G=u("loading");return p((n(),d("div",E,[f(D,{"label-width":"120px"},{default:v((()=>[f(s,{label:"选择导入实体"},{default:v((()=>[f(t,{modelValue:m(q).mainEntity,"onUpdate:modelValue":l[0]||(l[0]=e=>m(q).mainEntity=e),placeholder:"选择导入实体",style:{width:"400px"},filterable:"",onChange:P},{default:v((()=>[(n(!0),d(c,null,j(m(I),((e,l)=>(n(),b(a,{label:e.label,value:e.name,key:l},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),f(s,{label:"上传数据"},{default:v((()=>[y("div",F,[f(V,{accept:".xls, .xlsx",onOnSuccess:M,class:"ml-upload"},{trigger:v((()=>[f(_,null,{default:v((()=>[f(o,null,{default:v((()=>[f(i)])),_:1}),g("上传文件 ")])),_:1})])),_:1}),m(q).originalFilename?(n(),d("span",k,h(m(q).originalFilename),1)):w("",!0)]),U])),_:1}),f(s,{label:"遇到重复记录时"},{default:v((()=>[f(C,{modelValue:m(q).repeatOpt,"onUpdate:modelValue":l[1]||(l[1]=e=>m(q).repeatOpt=e)},{default:v((()=>[f(x,{label:1},{default:v((()=>[g("覆盖 (更新)")])),_:1}),f(x,{label:2},{default:v((()=>[g("跳过")])),_:1}),f(x,{label:3},{default:v((()=>[g("仍旧导入")])),_:1})])),_:1},8,["modelValue"]),3!=m(q).repeatOpt?(n(),d("div",z,[g(" 重复判断字段 "),f(H,{class:"sm-tip",effect:"dark",content:"选择的字段必须存在字段映射，否则会导致重复判断有误",placement:"top"},{default:v((()=>[f(o,{class:"sm-icon"},{default:v((()=>[f(L)])),_:1})])),_:1})])):w("",!0),3!=m(q).repeatOpt?(n(),b(t,{key:1,modelValue:m(q).repeatFields,"onUpdate:modelValue":l[2]||(l[2]=e=>m(q).repeatFields=e),placeholder:"选择字段",style:{width:"400px"},multiple:"","multiple-limit":3},{default:v((()=>[(n(!0),d(c,null,j(m(q).fields,((e,l)=>(n(),b(a,{label:e.fieldLabel,value:e.fieldName,key:l,filterable:""},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):w("",!0)])),_:1}),f(s,{label:"记录所属用户"},{default:v((()=>[y("div",N,[f(B,{type:"User",modelValue:m(q).owningUser,"onUpdate:modelValue":l[3]||(l[3]=e=>m(q).owningUser=e),clearable:""},null,8,["modelValue"])]),O,y("div",S,[f(_,{type:"primary",style:{width:"80px"},onClick:$},{default:v((()=>[g("下一步")])),_:1})])])),_:1})])),_:1})])),[[G,m(A)]])}}},[["__scopeId","data-v-10f87e43"]]);export{C as default};
