import{_ as e,ao as t,a9 as l,ak as i,a0 as a}from"./index-ea085229.js";import{l as s,o as r,i as o,w as n,z as d,f,c as m,a0 as p,ah as u,a as c,A as h,F as g,g as y,t as b,bh as E,bf as F}from"./@vue-1ad4818c.js";import"./element-plus-bab58d46.js";import"./lodash-es-b8e8104a.js";import"./@vueuse-477b4dbb.js";import"./@element-plus-2a6d398c.js";import"./@babel-6bd44fd1.js";import"./@popperjs-b78c3215.js";import"./@ctrl-4982d949.js";import"./dayjs-7fb79ad3.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./escape-html-3148dbc9.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-0ef99041.js";import"./vue3-manner-report-313033e6.js";import"./axios-85bcd05e.js";import"./crypto-js-43a3a23e.js";import"./cron-parser-1391a961.js";import"./luxon-b01799b6.js";import"./vue-router-414ebc36.js";import"./nprogress-c04e6182.js";import"./pinia-3f60a8e1.js";import"./sortablejs-2f5483e3.js";import"./qrcodejs2-fix-bab07f30.js";import"./moment-bafe441d.js";import"./pinyin-pro-c81f5d39.js";import"./vue-i18n-0843b5c5.js";import"./@intlify-2528d766.js";import"./source-map-b06bd4b9.js";import"./vue-c723f8b1.js";import"./pinia-plugin-persistedstate-d2bd58cf.js";import"./resize-observer-polyfill-ad543aa3.js";import"./vue-smart-widget-8b3f5b0a.js";import"./echarts-b5d24e9a.js";import"./zrender-a15b073b.js";import"./tslib-a4e99503.js";import"./echarts-liquidfill-f5c863f1.js";import"./@antv-43d380be.js";import"./ant-design-vue-2db0c9af.js";import"./@ant-design-60f2ef8e.js";import"./vue-types-6bcea8eb.js";import"./dom-align-78cb5391.js";import"./vue-draggable-next-a413f884.js";import"./vue-resize-observer-90aea344.js";const j={name:"AnyReferenceWidgetEditor",props:["entity","showingInDialog"],data(){return{fieldProps:{name:"",label:"",type:"AnyReference",defaultMemberOfListFlag:!1,nullable:!1,creatable:!0,updatable:!0,fieldViewModel:{searchDialogWidth:520,validators:[]},referTo:[],referenceSetting:[]},rules:{name:[{required:!0,message:"请输入字段名称",trigger:"blur"},{pattern:/^[a-z]+[A-Za-z\d]*$/,message:"请以小写英文字母开头，中间可输入字母或数字，禁止中文",trigger:"blur"},{min:2,max:30,message:"文字长度应在2-30之间",trigger:"blur"}],label:[{required:!0,message:"请输入显示名称",trigger:"blur"},{pattern:/^[A-Za-z\d\u4e00-\u9fa5]+[_-]*/,message:"请以中文、英文字母、数字开头，中间可输入下划线或横杠",trigger:"blur"},{min:2,max:30,message:"文字长度应在2-30之间",trigger:"blur"}]},validators:[],refEntityIndex:-1,referenceList:[{currentRefEntity:"",selectedFieldItems:[],refEntityAndFields:""}],refEntityName:"",refEntityLabel:"",refEntityFullName:"",showRefEntityDialogFlag:!1,showEntityListDialogFlag:!1,fieldItems:[],selectedFieldItems:[],columns:[{prop:"name",label:"实体名称",width:"150",align:"center"},{prop:"label",label:"显示名称",width:"200",align:"center",formatter:this.formatter}],tableData:[]}},mounted(){},methods:{saveField(){this.$refs.editorForm.validate((async e=>{if(!e)return this.$message.error("数据不合规范，请检查"),!1;if(this.fieldProps.referTo.length<=0||!this.fieldProps.referenceSetting)return void this.$message.error("请设置引用实体！");this.fieldProps.type="AnyReference";let l="";this.fieldProps.referTo.forEach(((e,t)=>{t!==this.fieldProps.referTo.length-1?l+=e+",":l+=e}));let i=await t(this.fieldProps,this.entity,l);i&&200==i.code&&(this.$message.success("保存成功"),this.$emit("fieldSaved"))}))},cancelSave(){this.$emit("cancelSave")},clearReferTo(e){this.referenceList[e].currentRefEntity="",this.referenceList[e].refEntityAndFields="",this.buildReferToAndReferenceSetting()},showRefEntitySettingDialog(e){this.showRefEntityDialogFlag=!0,this.refEntityIndex=e,this.refEntityName="",this.refEntityLabel="",this.refEntityFullName="",this.fieldItems.length=0,this.selectedFieldItems.length=0},setRefEntity(){this.showRefEntityDialogFlag=!1;let e=this.refEntityLabel+"[";for(let t=0;t<this.selectedFieldItems.length;t++)e+=this.selectedFieldItems[t].label+",";e+="]",this.referenceList[this.refEntityIndex].refEntityAndFields=e,this.referenceList[this.refEntityIndex].currentRefEntity=this.refEntityName,this.referenceList[this.refEntityIndex].selectedFieldItems=JSON.parse(JSON.stringify(this.selectedFieldItems)),this.buildReferToAndReferenceSetting()},async showEntityListDialog(){this.tableData.length=0;let e=await l();if(e&&200==e.code){let t=e.data;t&&t.filter((e=>{!1===e.detailEntityFlag&&this.tableData.push({name:e.name,label:e.label})})),this.showEntityListDialogFlag=!0}},async selectEntity(e){this.refEntityName=e.name,this.refEntityLabel=e.label,this.refEntityFullName=this.refEntityLabel+"("+this.refEntityName+")",this.showEntityListDialogFlag=!1,this.fieldItems.length=0;let t=await i(this.refEntityName);if(t&&200==t.code){let e=t.data;e&&e.filter((e=>{"PrimaryKey"!==e.type&&this.fieldItems.push(e)}))}},setRefEntityListField(e,t){if(t)this.selectedFieldItems.push(e);else for(let l=this.selectedFieldItems.length-1;l>=0;l--)this.selectedFieldItems[l].name===e.name&&this.selectedFieldItems.splice(l,1)},addRefEntity(){this.referenceList.push({currentRefEntity:"",refEntityAndFields:""})},deleteRefEntity(e){this.referenceList.splice(e,1),this.buildReferToAndReferenceSetting()},buildReferToAndReferenceSetting(){this.fieldProps.referTo.length=0,this.fieldProps.referenceSetting.length=0,this.referenceList.forEach((e=>{if(e.currentRefEntity&&e.selectedFieldItems){let t=[];e.selectedFieldItems.forEach((e=>{t.push(e.name)})),this.fieldProps.referTo.push(e.currentRefEntity),this.fieldProps.referenceSetting.push({entityName:e.currentRefEntity,fieldList:t})}}))},handleFieldLabelChange(e){e&&(this.fieldProps.name||(this.fieldProps.name=a(e)))},generateFieldName(){this.fieldProps.name=a(this.fieldProps.label)}}},_=e=>(E("data-v-785d1c50"),e=e(),F(),e),w=_((()=>y("hr",{style:{border:"0","margin-bottom":"15px"}},null,-1))),v=_((()=>y("hr",{style:{border:"0","border-top":"1px dotted #cccccc",margin:"-8px 0 12px"}},null,-1))),R=_((()=>y("hr",{style:{border:"0","margin-bottom":"15px"}},null,-1))),V=_((()=>y("div",{style:{"margin-bottom":"6px"}},"选择实体搜索列表字段：",-1))),k={key:0,style:{"font-style":"italic"}},L=_((()=>y("div",{style:{margin:"20px 0 6px"}},"已选择的显示字段：",-1))),I={key:0,style:{"font-style":"italic"}},P={class:"dialog-footer"};const x=e(j,[["render",function(e,t,l,i,a,E){const F=s("el-header"),j=s("el-input"),_=s("el-form-item"),x=s("el-button"),C=s("el-input-number"),D=s("el-radio"),S=s("el-radio-group"),A=s("el-form"),N=s("el-main"),T=s("el-checkbox"),U=s("el-card"),z=s("el-container"),M=s("el-dialog"),$=s("SimpleTable");return r(),o(z,{class:"field-props-container"},{default:n((()=>[l.showingInDialog?f("",!0):(r(),o(F,{key:0,class:"field-props-header"},{default:n((()=>[d("[一对多引用]字段属性设置")])),_:1})),m(N,{class:"field-props-pane"},{default:n((()=>[m(A,{model:a.fieldProps,ref:"editorForm",rules:a.rules,"label-position":"left","label-width":"220px",onSubmit:t[7]||(t[7]=p((()=>{}),["prevent"]))},{default:n((()=>[m(_,{label:"显示名称",prop:"label"},{default:n((()=>[m(j,{modelValue:a.fieldProps.label,"onUpdate:modelValue":t[0]||(t[0]=e=>a.fieldProps.label=e),onChange:E.handleFieldLabelChange},null,8,["modelValue","onChange"])])),_:1}),m(_,{label:"字段名称",prop:"name"},{default:n((()=>[m(j,{modelValue:a.fieldProps.name,"onUpdate:modelValue":t[1]||(t[1]=e=>a.fieldProps.name=e),disabled:1!==e.fieldState},u({_:2},[1===e.fieldState?{name:"append",fn:n((()=>[m(x,{onClick:E.generateFieldName},{default:n((()=>[d("刷新生成")])),_:1},8,["onClick"])])),key:"0"}:void 0]),1032,["modelValue","disabled"])])),_:1}),m(_,{label:"引用实体设置"},{default:n((()=>[m(x,{style:{float:"right"},icon:"el-icon-plus",onClick:E.addRefEntity},{default:n((()=>[d("添加")])),_:1},8,["onClick"])])),_:1}),w,(r(!0),c(g,null,h(a.referenceList,((e,t)=>(r(),o(_,{label:"引用实体"+(t+1),key:t},{default:n((()=>[m(j,{modelValue:e.refEntityAndFields,"onUpdate:modelValue":t=>e.refEntityAndFields=t,readonly:""},{append:n((()=>[e.currentRefEntity?(r(),o(x,{key:0,icon:"el-icon-close",title:"清除",onClick:e=>E.clearReferTo(t)},null,8,["onClick"])):f("",!0),m(x,{icon:"el-icon-search",title:"选择",onClick:e=>E.showRefEntitySettingDialog(t)},null,8,["onClick"]),m(x,{icon:"el-icon-delete",title:"删除",onClick:e=>E.deleteRefEntity(t)},null,8,["onClick"])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label"])))),128)),v,m(_,{label:"搜索弹窗宽度（单位：像素）："},{default:n((()=>[m(C,{type:"number",modelValue:a.fieldProps.fieldViewModel.searchDialogWidth,"onUpdate:modelValue":t[2]||(t[2]=e=>a.fieldProps.fieldViewModel.searchDialogWidth=e),modelModifiers:{number:!0},style:{width:"100%"}},null,8,["modelValue"])])),_:1}),m(_,{label:"是否在列表中默认显示"},{default:n((()=>[m(S,{modelValue:a.fieldProps.defaultMemberOfListFlag,"onUpdate:modelValue":t[3]||(t[3]=e=>a.fieldProps.defaultMemberOfListFlag=e),style:{float:"right"}},{default:n((()=>[m(D,{label:!0},{default:n((()=>[d("是")])),_:1}),m(D,{label:!1},{default:n((()=>[d("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(_,{label:"是否允许空值"},{default:n((()=>[m(S,{modelValue:a.fieldProps.nullable,"onUpdate:modelValue":t[4]||(t[4]=e=>a.fieldProps.nullable=e),style:{float:"right"}},{default:n((()=>[m(D,{label:!0},{default:n((()=>[d("是")])),_:1}),m(D,{label:!1},{default:n((()=>[d("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(_,{label:"新建记录时允许修改字段"},{default:n((()=>[m(S,{modelValue:a.fieldProps.creatable,"onUpdate:modelValue":t[5]||(t[5]=e=>a.fieldProps.creatable=e),style:{float:"right"}},{default:n((()=>[m(D,{label:!0},{default:n((()=>[d("是")])),_:1}),m(D,{label:!1},{default:n((()=>[d("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),m(_,{label:"更新记录时允许修改字段"},{default:n((()=>[m(S,{modelValue:a.fieldProps.updatable,"onUpdate:modelValue":t[6]||(t[6]=e=>a.fieldProps.updatable=e),style:{float:"right"}},{default:n((()=>[m(D,{label:!0},{default:n((()=>[d("是")])),_:1}),m(D,{label:!1},{default:n((()=>[d("否")])),_:1})])),_:1},8,["modelValue"])])),_:1}),R,m(_,null,{default:n((()=>[m(x,{type:"primary",style:{width:"120px"},onClick:E.saveField},{default:n((()=>[d("保存字段")])),_:1},8,["onClick"]),l.showingInDialog?(r(),o(x,{key:0,onClick:E.cancelSave},{default:n((()=>[d("取消")])),_:1},8,["onClick"])):f("",!0)])),_:1})])),_:1},8,["model","rules"])])),_:1}),m(M,{title:"引用实体设置",class:"refer-entity-dialog",modelValue:a.showRefEntityDialogFlag,"onUpdate:modelValue":t[10]||(t[10]=e=>a.showRefEntityDialogFlag=e),"append-to-body":!0,width:"560px"},{footer:n((()=>[y("div",P,[m(x,{onClick:t[9]||(t[9]=e=>a.showRefEntityDialogFlag=!1)},{default:n((()=>[d("取 消")])),_:1}),m(x,{type:"primary",onClick:E.setRefEntity},{default:n((()=>[d("确 定")])),_:1},8,["onClick"])])])),default:n((()=>[m(z,null,{default:n((()=>[m(F,null,{default:n((()=>[m(j,{placeholder:"请选择引用实体",modelValue:a.refEntityFullName,"onUpdate:modelValue":t[8]||(t[8]=e=>a.refEntityFullName=e)},{append:n((()=>[m(x,{icon:"el-icon-search",title:"选择",onClick:E.showEntityListDialog},null,8,["onClick"])])),_:1},8,["modelValue"])])),_:1}),m(N,null,{default:n((()=>[y("div",null,[V,m(U,{shadow:"never"},{default:n((()=>[a.fieldItems.length<=0?(r(),c("div",k,"暂无字段可选")):f("",!0),(r(!0),c(g,null,h(a.fieldItems,((e,t)=>(r(),o(T,{key:t,onChange:t=>E.setRefEntityListField(e,t)},{default:n((()=>[d(b(e.label)+"("+b(e.name)+")",1)])),_:2},1032,["onChange"])))),128))])),_:1})]),y("div",null,[L,m(U,{shadow:"never"},{default:n((()=>[a.selectedFieldItems.length<=0?(r(),c("div",I,"未选择显示字段")):f("",!0),(r(!0),c(g,null,h(a.selectedFieldItems,((e,t)=>(r(),c("div",{key:t},b(e.label)+"("+b(e.name)+")",1)))),128))])),_:1})])])),_:1})])),_:1})])),_:1},8,["modelValue"]),m(M,{ref:"entityListDlg",title:"选择引用实体",modelValue:a.showEntityListDialogFlag,"onUpdate:modelValue":t[11]||(t[11]=e=>a.showEntityListDialogFlag=e),"append-to-body":!0,class:"entity-list-dialog",width:"560px"},{default:n((()=>[m($,{"show-pagination":!1,"show-check-box":!1,"table-size":"small",columns:a.columns,data:a.tableData,"show-operation-column":!0,"max-height":420},{table_operation:n((({scope:e})=>[m(x,{class:"",icon:"el-icon-check",onClick:t=>E.selectEntity(e.row)},{default:n((()=>[d("选择")])),_:2},1032,["onClick"])])),_:1},8,["columns","data"])])),_:1},8,["modelValue"])])),_:1})}],["__scopeId","data-v-785d1c50"]]);export{x as default};
